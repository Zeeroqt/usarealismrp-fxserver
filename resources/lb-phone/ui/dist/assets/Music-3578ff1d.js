import{r as m,a as l,j as e}from"./jsx-runtime-7cf68bf7.js";import{f as w,a2 as D,M as x,C as T,L as h,a8 as L,b as U,bg as O,bh as b,ag as j,a0 as $,a1 as E,bi as q,az as V,j as _,bj as Y,bk as F,aj as G,c as k,ak as y,bl as H,bm as B,w as W,bn as z,K as X}from"./Phone-e1d97322.js";import"./number-28525126.js";function K(){const{Data:N,Playlist:v}=m.useContext(M),[a,s]=v,[S,d]=N,[t,n]=m.useState([]);m.useEffect(()=>{w("Music",{action:"getPlaylists"}).then(i=>{i&&n(i.map(u=>({...u,Songs:u.Songs.map(c=>{var g;return{...S.Songs.find(I=>I.Path===c),Cover:(g=S.Songs.find(I=>I.Path===c&&(S.Albums[I.Album]??S.Songs[c])))==null?void 0:g.Cover,Path:c}})})))})},[]);const r=(i,u)=>{!i||!u||w("Music",{action:"addSong",id:i,song:u}).then(c=>{c&&s(null)})};return l(D.div,{className:"add-playlist-container",initial:{opacity:0,y:"100%"},animate:{opacity:1,y:0},exit:{opacity:1,y:"100%"},children:[e("div",{className:"music-header",children:e("div",{className:"left",children:e(x,{onClick:()=>s(null)})})}),e("div",{className:"music-body",children:e("div",{className:"library",children:t.map((i,u)=>l("div",{className:"playlist",onClick:()=>{i.Songs.includes(a.Path)?T.PopUp.set({title:h("APPS.MUSIC.SONG_EXISTS_POPUP.TITLE"),description:h("APPS.MUSIC.SONG_EXISTS_POPUP.DESCRIPTION"),buttons:[{title:h("APPS.MUSIC.SONG_EXISTS_POPUP.CANCEL")}]}):r(i.Id,a.Path)},children:[l("div",{className:"playlist-details",children:[i.cover?e("img",{src:i.Cover}):i.Songs.length>0?e("div",{className:"playlist-cover","data-grid":i.Songs.filter(c=>c.Cover).length>=4,children:i.Songs.filter(c=>c.Cover).length>=4?i.Songs.filter((c,g)=>g<4).map((c,g)=>e("img",{src:c.Cover})):e("img",{src:i.Songs[0].Cover})}):e("img",{src:"./assets/img/icons/music/unknown.png"}),l("div",{className:"text",children:[e("div",{className:"title",children:i.Title}),l("div",{className:"subtitle",children:[i.Songs.length," ",h("APPS.MUSIC.SONGS").toLowerCase()]})]})]}),e(L,{})]},u))})})]})}function Q(){const{View:N,SelectedData:v,Func:a}=m.useContext(M),s=U(b),[S,d]=N,[t]=v;return e("div",{className:"slide left",children:e("div",{className:"music-body",children:l("div",{className:"artist-profile",children:[l("div",{className:"avatar",style:{backgroundImage:`url(${t.Avatar})`},children:[e("div",{className:"top",children:e(x,{onClick:()=>d("search")})}),e("div",{className:"title",children:t.Name})]}),l("div",{className:"category",children:[l("div",{className:"title",children:[h("APPS.MUSIC.SONGS"),e(L,{})]}),e("section",{children:t.songs.map((n,r)=>{var u;let i=((u=s==null?void 0:s.song)==null?void 0:u.Path)===n.Path;return l("div",{className:"song","data-playing":i,onClick:()=>{a.play({song:n,queue:[...t.songs.filter((c,g)=>g>r)]})},children:[l("div",{className:"song-info",children:[e("img",{src:n.Cover??"./assets/img/icons/music/unknown.png",alt:""}),l("div",{className:"text",children:[e("div",{className:"title",children:n.Title}),n.Album&&e("div",{className:"subtitle",children:n.Album})]})]}),e(O,{onClick:c=>{c.stopPropagation(),a.setContext(n)}})]},r)})})]}),l("div",{className:"category",children:[l("div",{className:"title",children:[h("APPS.MUSIC.ALBUMS"),e(L,{})]}),e("section",{className:"albums",children:t.albums.map((n,r)=>l("div",{className:"album",onClick:()=>{a.fetchAndSet(n.Title,"Albums")},children:[e("img",{src:n.Cover,alt:""}),e("div",{className:"title",children:n.Title})]},r))})]})]})})})}function J(){const{Func:N,Data:v}=m.useContext(M),[a,s]=m.useState(""),[S]=v,[d,t]=m.useState(null);return m.useEffect(()=>{w("Music",{action:"getPlaylists"}).then(n=>{n&&t(n.map(r=>({...r,Songs:r.Songs.map(i=>{var u;return{...S.Songs.find(c=>c.Path===i),Cover:(u=S.Songs.find(c=>c.Path===i&&(S.Albums[c.Album]??S.Songs[i])))==null?void 0:u.Cover,Path:i}})})))})},[]),l("div",{className:"slide right",children:[e("div",{className:"music-header",children:l("div",{className:"space",children:[e("div",{className:"title",children:h("APPS.MUSIC.LIBRARY")}),e(j,{onClick:()=>{T.PopUp.set({title:h("APPS.MUSIC.NEW_PLAYLIST_POPUP.TITLE"),description:h("APPS.MUSIC.NEW_PLAYLIST_POPUP.DESCRIPTION"),input:{placeholder:h("APPS.MUSIC.NEW_PLAYLIST_POPUP.PLACEHOLDER"),type:"text",minCharacters:1,onChange:n=>s(n)},buttons:[{title:h("APPS.MUSIC.NEW_PLAYLIST_POPUP.CANCEL")},{title:h("APPS.MUSIC.NEW_PLAYLIST_POPUP.PROCEED"),cb:()=>{s(n=>(w("Music",{action:"createPlaylist",name:n}).then(r=>{r&&t(i=>[...i,{id:r,Title:n,Songs:[]}])}),n))}}]})}})]})}),e("div",{className:"music-body",children:e("div",{className:"library",children:d&&d.map((n,r)=>l("div",{className:"playlist",onClick:()=>N.fetchAndSet(n,"playlist",!0),children:[l("div",{className:"playlist-details",children:[n.Cover?e("img",{src:n.Cover??"./assets/img/icons/music/unknown.png"}):n.Songs.length>0?e("div",{className:"playlist-cover","data-grid":n.Songs.filter(i=>i.Cover).length>=4,children:n.Songs.filter(i=>i.Cover).length>=4?n.Songs.filter((i,u)=>u<4).map((i,u)=>e("img",{src:i.Cover})):e("img",{src:n.Songs[0].Cover??"./assets/img/icons/music/unknown.png"})}):e("img",{src:"./assets/img/icons/music/unknown.png"}),l("div",{className:"text",children:[e("div",{className:"title",children:n.Title}),l("div",{className:"subtitle",children:[n.Songs.length," songs"]})]})]}),e(L,{})]},r))})})]})}function Z(){var r,i,u,c;const{View:N,Player:v}=m.useContext(M),a=U(b),[s,S]=N,[d,t]=v;let n=[{icon:e(E,{}),value:"library",label:h("APPS.MUSIC.LIBRARY")},{icon:e(q,{}),value:"search",label:h("APPS.MUSIC.SEARCH")}];return l("div",{className:"music-footer",children:[l("div",{className:"music-playing",onClick:()=>{a&&t(!0)},children:[l("div",{className:"song-info",children:[e("img",{src:((r=a==null?void 0:a.song)==null?void 0:r.Cover)??"./assets/img/icons/music/unknown.png",alt:""}),l("div",{className:"text",children:[e("div",{className:"title",children:((i=a==null?void 0:a.song)==null?void 0:i.Title)??h("APPS.MUSIC.NOT_PLAYING")}),((u=a==null?void 0:a.song)==null?void 0:u.Artist)&&e("div",{className:"subtitle",children:(c=a==null?void 0:a.song)==null?void 0:c.Artist})]})]}),e("div",{className:"controls",onClick:g=>{g.stopPropagation(),a&&b.patch({playing:!a.playing})},children:a&&a.playing?e($,{}):e(E,{})})]}),e("div",{className:"items",children:n.map((g,I)=>l("div",{className:"item","data-active":s===g.value,onClick:()=>S(g.value),children:[g.icon,g.label]},I))})]})}function ee(){var I,o,P,A;const{View:N,Player:v}=m.useContext(M),a=U(k.Settings),s=U(b),[S,d]=v,[t,n]=m.useState(!1),[r,i]=m.useState(null),[u,c]=m.useState("rgb(170, 170, 170)");m.useEffect(()=>{var C;s&&((C=s==null?void 0:s.song)!=null&&C.Cover)&&V(s.song.Cover).then(p=>{p&&c(`
                    linear-gradient(0deg,
                        ${p.dominant} 0%,
                        ${p.average} 50%,
                        ${p.muted} 100%
                    )
                `)})},[(I=s==null?void 0:s.song)==null?void 0:I.Cover]);const g=C=>{if(!C)return"0:00";let p=Math.floor(C/60),f=Math.floor(C-p*60),R=f<10?"0"+f:f;return p+":"+R};return l(D.div,{className:"music-player",style:{background:u},initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{duration:.3},children:[e("div",{className:"music-player-header",onClick:()=>d(!1)}),l("div",{className:"music-player-body",children:[e("img",{className:"cover",src:((o=s==null?void 0:s.song)==null?void 0:o.Cover)??"./assets/img/icons/music/unknown.png"}),l("div",{className:"song-info",children:[e("div",{className:"title",children:((P=s==null?void 0:s.song)==null?void 0:P.Title)??h("APPS.MUSIC.NOT_PLAYING")}),e("div",{className:"subtitle",children:((A=s==null?void 0:s.song)==null?void 0:A.Artist)??""})]}),l("div",{className:"duration",children:[e(_,{type:"range",min:0,max:100,value:s?r||((s==null?void 0:s.current)??0/(s==null?void 0:s.duration)??0)*100:0,style:{background:s!=null&&s.current?`linear-gradient(to right, rgb(255, 255, 255) 0%, rgb(255, 255, 255) ${Math.floor(r||s.current/s.duration*100)}%, rgba(255, 255, 255, 0.3) ${Math.floor(r||s.current/s.duration*100)}%, rgba(255, 255, 255, 0.3) 100%)`:"rgba(255, 255, 255, 0.3)"},onMouseDown:()=>n(!0),onMouseUp:C=>{n(!1),r&&s&&(s.goTo(s.duration/100*r),i(null))},onChange:C=>i(C.target.value)}),l("div",{className:"time",children:[e("div",{className:"current",children:g(r?(s==null?void 0:s.duration)/100*r:s==null?void 0:s.current)}),e("div",{className:"total",children:g(s==null?void 0:s.duration)})]})]}),l("div",{className:"controls",children:[e(Y,{onClick:()=>s==null?void 0:s.previous()}),e("div",{className:"play",onClick:()=>{s&&b.patch({playing:!s.playing})},children:s!=null&&s.playing?e($,{}):e(E,{})}),e(F,{onClick:()=>s==null?void 0:s.next()})]}),l("div",{className:"volume",children:[e(G,{}),e(_,{type:"range",min:0,max:1,step:.05,style:{background:`linear-gradient(to right, rgb(255, 255, 255) 0%, rgb(255, 255, 255) ${a.sound.volume*100}%, rgba(255, 255, 255, 0.3) ${a.sound.volume*100}%, rgba(255, 255, 255, 0.3) 100%)`},value:a.sound.volume,onChange:C=>{k.Settings.patch({sound:{...k.Settings.value.sound,volume:C.target.value}})}}),e(y,{})]})]})]})}function se(){const{View:N,SelectedData:v,Func:a}=m.useContext(M),s=U(b),[S,d]=N,[t]=v,[n]=m.useState(!!t.Artist);return l("div",{className:"slide left",children:[e("div",{className:"music-header",children:l("div",{className:"space",children:[e(x,{onClick:()=>t.Artist?d("search"):d("library")}),!n&&e(H,{onClick:r=>{r.stopPropagation(),T.ContextMenu.set({buttons:[{title:h("APPS.MUSIC.DELETE_PLAYLIST"),color:"red",cb:()=>{w("Music",{action:"deletePlaylist",id:t.Id}).then(i=>{i&&d("library")})}}]})}})]})}),e("div",{className:"music-body",children:l("div",{className:"playlist-wrapper",children:[l("div",{className:"playlist-details",children:[t.Cover?e("img",{src:t.Cover}):t.Songs.length>0?e("div",{className:"playlist-cover","data-grid":t.Songs.filter(r=>r.Cover).length>=4,children:t.Songs.filter(r=>r.Cover).length>=4?t.Songs.filter((r,i)=>i<4).map((r,i)=>e("img",{src:r.Cover})):e("img",{src:t.Songs[0].Cover??"./assets/img/icons/music/unknown.png"})}):e("img",{src:"./assets/img/icons/music/unknown.png"}),l("div",{className:"text",children:[e("div",{className:"title",children:t.Title}),e("div",{className:"subtitle",children:n?t.Artist:`${Object.keys(t.Songs).length} ${h("APPS.MUSIC.SONGS").toLowerCase()}`})]}),l("div",{className:"buttons",children:[l("div",{className:"button",onClick:()=>{a.play({song:t.Songs[0],queue:[...t.Songs.filter((r,i)=>i>0)]})},children:[e(E,{})," ",h("APPS.MUSIC.PLAY")]}),l("div",{className:"button",onClick:()=>{a.play({song:t.Songs[Math.floor(Math.random()*t.Songs.length)],queue:[...t.Songs.filter((r,i)=>i>0)].sort(()=>Math.random()-.5)})},children:[e(B,{}),h("APPS.MUSIC.SHUFFLE")]})]})]}),e("div",{className:"playlist-tracks",children:t.Songs.map((r,i)=>{var c;let u=((c=s==null?void 0:s.song)==null?void 0:c.Path)===r.Path;return l("div",{className:"track","data-album":n,"data-playing":u,onClick:()=>{a.play({song:r,queue:[...t.Songs.filter((g,I)=>I>i)]})},children:[l("div",{className:"track-info",children:[n?e("div",{className:"index",children:i+1}):e("img",{src:r.Cover??"./assets/img/icons/music/unknown.png"}),l("div",{className:"text",children:[e("div",{className:"title",children:r.Title}),e("div",{className:"subtitle",children:n?t.Artist:r.Artist})]})]}),e(O,{onClick:g=>{g.stopPropagation(),a.setContext(r)}})]},i)})})]})})]})}function te(){const{Func:N,Data:v}=m.useContext(M),a=U(b),[s,S]=m.useState(""),[d]=v;return l("div",{className:"slide right",children:[e("div",{className:"music-header",children:l("div",{className:"search",children:[e("div",{className:"title",children:h("APPS.MUSIC.SEARCH")}),e(W,{placeholder:h("APPS.MUSIC.SEARCH_PLACEHOLDER"),onChange:t=>S(t.target.value)})]})}),e("div",{className:"music-body",children:e("div",{className:"search-results",children:s.length>0&&Object.keys(d).map(t=>Object.keys(d[t]).filter(n=>{switch(t){case"Artists":return n.toLowerCase().includes(s.toLowerCase());case"Albums":return n.toLowerCase().includes(s.toLowerCase());case"Songs":return d[t][n].Title.toLowerCase().includes(s.toLowerCase())}}).map((n,r)=>{var u;let i;return t==="Songs"&&(i=((u=a==null?void 0:a.song)==null?void 0:u.Path)===d[t][n].Path),l("div",{className:"item","data-playing":i,onClick:()=>{t==="Songs"?N.play({song:d[t][n],queue:[...d.Songs.filter((c,g)=>d[t][n].Path!==c.Path&&g>r)]}):N.fetchAndSet(n,t)},children:[l("div",{className:"item-info",children:[e("img",{src:(t==="Artists"?d[t][n].Avatar:d[t][n].Cover)??"./assets/img/icons/music/unknown.png","data-artist":t==="Artists"}),l("div",{className:"text",children:[e("div",{className:"title",children:t==="Songs"?d[t][n].Title:n}),l("div",{className:"subtitle",children:[t==="Artists"&&h("APPS.MUSIC.ARTIST"),t==="Albums"&&`${h("APPS.MUSIC.ALBUM")} • ${d[t][n].Artist}`,t==="Songs"&&`${h("APPS.MUSIC.SONG")} • ${d[t][n].Artist}`]})]})]}),e("div",{className:"item-actions",children:t==="Songs"?e(O,{onClick:c=>{c.stopPropagation(),N.setContext(d[t][n])}}):e(L,{})})]})}))})})]})}const M=m.createContext(null);function le(){const[N,v]=m.useState("search"),[a,s]=m.useState(null),[S,d]=m.useState(null),[t,n]=m.useState(!1),[r,i]=m.useState(null),u={search:e(te,{}),artist:e(Q,{}),library:e(J,{}),playlist:e(se,{})},c=(o,P,A)=>{if(o&&!(!a[P]&&!A))if(P==="Albums"){let C=Object.keys(a.Songs).filter(p=>a.Songs[p].Album===o).map(p=>a.Songs[p]);d({...a[P][o],Songs:C,Title:o}),v("playlist")}else if(P==="Artists"){let C=Object.keys(a.Songs).filter(f=>a.Songs[f].Artist===o).map(f=>a.Songs[f]),p=Object.keys(a.Albums).filter(f=>a.Albums[f].Artist===o).map(f=>({...a.Albums[f],Title:f}));d({...a[P][o],Name:o,songs:C,albums:p}),v("artist")}else P==="playlist"&&(d(o),v("playlist"))},g=o=>{var P,A;!o||!o.song||(b.value?b.patch({playing:!0,song:o.song,queue:o.queue??((P=b.value)==null?void 0:P.queue)??[]}):b.set({playing:!0,song:o.song,queue:o.queue??((A=b.value)==null?void 0:A.queue)??[]}))},I=o=>{if(!o)return;let P=[{title:h("APPS.MUSIC.ADD_QUEUE"),color:null,cb:()=>{b.patch({queue:[...b.value.queue,o]})}},{title:h("APPS.MUSIC.ADD_PLAYLIST"),color:null,cb:()=>{i(o)}}];S.IsOwner&&P.push({title:h("APPS.MUSIC.REMOVE_SONG"),color:"red",cb:()=>{w("Music",{action:"removeSong",id:S.Id,song:o.Path}).then(A=>{A&&d(C=>{let p=C.Songs.filter(f=>f.Path!==o.Path);return{...C,Songs:p}})})}}),T.ContextMenu.set({buttons:P})};return m.useEffect(()=>{z()&&s({Songs:[{Title:"Test",Path:"test.mp3",Cover:"https://source.unsplash.com/random",Artist:"Artist Name"}],Albums:[],Artists:[]}),w("Music",{action:"getConfig"}).then(o=>{if(!o)return;let P=Object.keys(o.Songs).map(A=>({...o.Songs[A],Cover:o.Songs[A].Album&&o.Albums[o.Songs[A].Album]?o.Albums[o.Songs[A].Album].Cover:o.Songs[A].Cover,Path:A}));s({...o,Songs:P})})},[]),e("div",{className:"music-container",children:l(M.Provider,{value:{View:[N,v],Data:[a,s],SelectedData:[S,d],Player:[t,n],Playlist:[r,i],Func:{fetchAndSet:c,play:g,setContext:I}},children:[l(X,{initial:!1,children:[t&&e(ee,{}),r&&e(K,{})]}),u[N],e(Z,{})]})})}export{M as MusicContext,le as default};
