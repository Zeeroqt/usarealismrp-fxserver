import{r as f,j as v,a as N,F as V}from"./jsx-runtime-f40812bf.js";import{r as S}from"./index-0dd4a6fb.js";import{f as y,d as i,u as m,$ as p,P as C,a as E}from"./Phone-bbdfbfe1.js";import"./number-28525126.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const e of r)if(e.type==="childList")for(const o of e.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&l(o)}).observe(document,{childList:!0,subtree:!0});function a(r){const e={};return r.integrity&&(e.integrity=r.integrity),r.referrerpolicy&&(e.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?e.credentials="include":r.crossorigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function l(r){if(r.ep)return;r.ep=!0;const e=a(r);fetch(r.href,e)}})();var g={},P=S;g.createRoot=P.createRoot,g.hydrateRoot=P.hydrateRoot;const w=()=>{const[t,c]=f.useState(null);return f.useEffect(()=>{y("voice:getConfig").then(a=>{if(!a)return i("error","VoiceProvider: No config found");c(a)})},[]),t!=null&&t.recordNearbyVoices?v(x,{config:t}):null},x=({config:t})=>{const c=f.useRef(null),[a,l]=f.useState([]),r=e=>{if(!c.current)return i("warning","VoiceProvider: No audio stream");i("info",`VoiceProvider: ${e?"muting":"umuting"} audio stream`),a.forEach(o=>{o.gainNode.gain.value=e?0:o.volume,i("info",`VoiceProvider: Set volume to ${e?0:o.volume} for channel ${o.id}`)})};return m("camera:toggleMicrophone",e=>{r(!e)}),f.useEffect(()=>{var e;return(e=navigator.mediaDevices)==null||e.getUserMedia({audio:{autoGainControl:!1,noiseSuppression:!1,echoCancellation:!1}}).then(o=>{c.current=o,i("info","VoiceProvider: Got audio stream")}),()=>{var o;a.forEach(n=>{n.peer.destroy()}),(o=c.current)==null||o.getTracks().forEach(n=>n.stop())}},[]),m("voice:joinChannel",e=>{if(!c.current)return i("warning","VoiceProvider: No audio stream");if(a.find(d=>d.id===e.channel))return i("warning","VoiceProvider: Already connected to channel "+e.channel);i("info","Joining voice channel "+JSON.stringify(e));let o=new AudioContext,n=o.createMediaStreamSource(c.current),s=o.createMediaStreamDestination(),u=o.createGain();u.gain.value=e.volume,n.connect(u),u.connect(s),y("isTalking").then(d=>{d||(u.gain.value=0)});const h=t!=null&&t.ice?new p({config:{iceTransportPolicy:"relay",iceServers:t==null?void 0:t.ice}}):new p;h.on("open",()=>{h.call(e.channel,s.stream),l(d=>[...d,{id:e.channel,volume:e.volume,peer:h,gainNode:u,audioCtx:o}])})}),m("voice:leaveChannel",e=>{i("info","Leaving voice channel "+e);const o=a.find(n=>n.id===e);if(!o)return i("warning","VoiceProvider: Not connected to channel "+e);o.audioCtx.close(),o.peer.destroy(),l(n=>n.filter(s=>s.id!==e))}),m("voice:setVolume",e=>{i("info","Setting volume for channel "+e.channel+" to "+e.volume);const o=a.find(n=>n.id===e.channel);if(!o)return i("warning","VoiceProvider: Not connected to channel "+e.channel);o.gainNode.gain.value=e.volume,l(n=>n.map(s=>s.id===e.channel?{...s,volume:e.volume}:s))}),null};g.createRoot(document.getElementById("root")).render(N(V,{children:[v(C,{children:v(E,{})}),v(w,{})]}));
