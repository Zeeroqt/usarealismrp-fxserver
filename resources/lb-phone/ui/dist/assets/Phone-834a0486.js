import{r as N,a as n,j as e,F as S}from"./jsx-runtime-7cf68bf7.js";import{b as T,L as t,C as b,c as X,aa as V,ab as U,x as H,ac as k,e as L,a as f,ad as J,G as w,O as j,ae as Q,af as D,j as O,f as p,d as K,ag as Z,a7 as q,ah as z,ai as Y,aj as ee,H as F,ak as ae,al as te,am as ne,an as se,ao as ie}from"./PhoneProvider-fb5cb781.js";import{S as ce}from"./Phone-d1a23bb8.js";import{r as G}from"./number-28525126.js";import"./color-e1a4c391.js";import"./index.esm-3a7b91c6.js";import"./AppStore-52953299.js";import"./Pin-e697d693.js";function le(){const{View:P,Contact:E}=N.useContext(I),r=T(f.Settings),d=T(f.PhoneNumber),[l,C]=N.useState(null),[u,h]=P,[a,c]=E,o=T(O.APPS.PHONE.contacts),[s,v]=N.useState(!1),[m,R]=N.useState(!1);N.useEffect(()=>C(a.number),[]);const M=()=>{p("Phone",{action:"removeContact",number:a.number}).then(()=>{O.APPS.PHONE.contacts.set(o.filter(i=>i.number!==a.number)),c(null),h("Contacts")})},A=()=>{p("Phone",{action:"toggleBlock",number:a.number,blocked:!a.blocked}).then(()=>{c({...a,blocked:!a.blocked}),O.APPS.PHONE.contacts.set(o.map(i=>i.number===a.number?{...i,blocked:!i.blocked}:i))})},g=()=>{p("Phone",{action:"toggleFavourite",number:a.number,favourite:!a.favourite}).then(()=>{c({...a,favourite:!a.favourite}),O.APPS.PHONE.contacts.set(o.map(i=>i.number===a.number?{...i,favourite:!i.favourite}:i))})},y=()=>{if(!a.number||a.number.length===0)return h("Contacts");a.number===d?(f.Settings.patch({name:a.firstname,avatar:a.avatar??r.avatar}),p("setPhoneName",a.firstname),p("setSettings",f.Settings.value),v(i=>!i),O.APPS.PHONE.contacts.set(o.map(i=>i.number===a.number?{...i,...a}:i))):(a.lastname=a.lastname??"",p("Phone",{action:"updateContact",data:{...a,oldNumber:l}}).then(()=>{v(i=>!i),O.APPS.PHONE.contacts.set(o.map(i=>i.number===a.number?{...i,...a}:i)),C(a.number)}))},B=()=>{a&&b.PopUp.set({title:t("APPS.MESSAGES.SEND_LOCATION_POPUP.TITLE"),description:t("APPS.MESSAGES.SEND_LOCATION_POPUP.TEXT"),buttons:[{title:t("APPS.MESSAGES.SEND_LOCATION_POPUP.CANCEL")},{title:t("APPS.MESSAGES.SEND_LOCATION_POPUP.SEND"),cb:()=>{p("Maps",{action:"getCurrentLocation"}).then(i=>{i&&p("Messages",{action:"sendMessage",number:a.number,content:`<!SENT-LOCATION-X=${G(i.x,2)}Y=${G(i.y,2)}!>`,attachments:[]}).then(_=>{_?f.App.set({name:"Messages",data:{number:a.number,name:a.firstname&&k(a.firstname,a.lastname),avatar:a.avatar},view:"messages"}):K("warning","something went wrong while sending location")})})}}]})},x=N.useRef(!0);return N.useEffect(()=>{x.current&&x.current&&(C(a.number),x.current=!1,R(a.number===d))},[a]),n("div",{className:"slide left",children:[e("div",{className:"contacts-header",children:n("div",{className:"items",children:[s?e("span",{}):n("div",{className:"back",onClick:()=>{h(a.from),c(null)},children:[e("i",{className:"fal fa-chevron-left"}),t(`APPS.PHONE.${a.from.toUpperCase()}.TITLE`)]}),a.firstname&&!a.company&&e("span",{onClick:()=>{s?y():v(i=>!i)},children:s?t("APPS.PHONE.DONE"):t("APPS.PHONE.EDIT")})]})}),e("div",{className:"content",children:s?e(S,{children:n("div",{className:"contact nohover",children:[n("div",{className:"user",onClick:()=>{var i,_,$;b.Gallery.set({allowExternal:($=(_=(i=X)==null?void 0:i.value)==null?void 0:_.AllowExternal)==null?void 0:$.Other,onSelect:W=>c({...a,avatar:W.src})})},children:[a.avatar||m&&r.avatar?e("div",{className:"profile-image bigger",style:{backgroundImage:`url(${a.avatar??r.avatar})`}}):a.firstname?e("div",{className:"profile-image bigger",children:V(a.firstname,a.lastname)}):e(U,{}),e("span",{children:t("APPS.PHONE.EDIT")})]}),n("div",{className:"contact-info",children:[e("div",{className:"item input",children:e(H,{type:"text",placeholder:t("APPS.PHONE.CONTACTS.FIRST_NAME"),value:a.firstname,onChange:i=>c({...a,firstname:i.target.value}),maxLength:20})}),!m&&e("div",{className:"item input",children:e(H,{type:"text",placeholder:t("APPS.PHONE.CONTACTS.LAST_NAME"),value:a.lastname??"",onChange:i=>c({...a,lastname:i.target.value}),maxLength:20})})]}),e("div",{className:"contact-info",children:e("div",{className:"item input",children:e(H,{className:"phone_number",type:"number",placeholder:t("APPS.PHONE.CONTACTS.PHONE_NUMBER"),defaultValue:a==null?void 0:a.number,maxLength:20,disabled:m,onChange:i=>{if(m)return;let _=i.target.value.slice(-1).charCodeAt(0);_>=48&&_<=57&&i.target.value.length<=10&&c({...a,number:i.target.value})}})})}),n("div",{className:"contact-info",children:[e("div",{className:"item input",children:e(H,{className:"phone_number",type:"email",placeholder:t("APPS.PHONE.CONTACTS.EMAIL"),defaultValue:a==null?void 0:a.email,maxLength:20,disabled:m,onChange:i=>{m||i.target.value.match(/^([\w.%+-]+)@([\w-]+\.)+([\w]{2,})$/i)&&c({...a,email:i.target.value})}})}),e("div",{className:"item input",children:e(H,{type:"text",placeholder:t("APPS.PHONE.CONTACTS.ADDRESS"),defaultValue:a==null?void 0:a.address,maxLength:20,disabled:m,onChange:i=>{m||c({...a,address:i.target.value})}})})]}),!m&&e("div",{className:"contact-info",children:e("div",{className:"item red",onClick:()=>{b.PopUp.set({title:t("APPS.PHONE.CONTACTS.REMOVE_CONTACT_TITLE"),description:t("APPS.PHONE.CONTACTS.REMOVE_CONTACT_TEXT"),buttons:[{title:t("APPS.PHONE.CONTACTS.REMOVE_CONTACT_BUTTON_CANCEL")},{title:t("APPS.PHONE.CONTACTS.REMOVE_CONTACT_BUTTON_DELETE"),color:"red",cb:M}]})},children:t("APPS.PHONE.CONTACTS.DELETE_CONTACT")})})]})}):e(S,{children:n("div",{className:"contact nohover details",children:[n("div",{className:"user",children:[a.avatar||m&&r.avatar?e("div",{className:"profile-image bigger",style:{backgroundImage:`url(${m?r.avatar:a.avatar})`}}):a.firstname?e("div",{className:"profile-image bigger",children:V(a.firstname,a.lastname)}):e(U,{}),e("div",{className:"name",children:a.firstname?k(a.firstname,a.lastname):L(a.number)})]}),n("div",{className:"actions",children:[n("div",{className:"item","data-disabled":!!(m||a.company),onClick:()=>{f.App.set({name:"Messages",data:{number:a.number,name:a.firstname&&k(a.firstname,a.lastname),avatar:a.avatar},view:"messages"})},children:[e(J,{}),t("APPS.PHONE.CONTACTS.MESSAGE")]}),n("div",{className:"item call","data-disabled":m,onClick:()=>{w({number:a.number,company:a.company,companylabel:a.company&&a.firstname})},children:[e(j,{}),t("APPS.PHONE.CONTACTS.CALL")]}),n("div",{className:"item","data-disabled":!!(m||a.company),onClick:()=>{w({number:a.number,company:a.company,companylabel:a.company&&a.firstname,videoCall:!0})},children:[e(Q,{}),t("APPS.PHONE.CONTACTS.VIDEO")]})]}),!a.company&&n(S,{children:[e("div",{className:"contact-info",children:n("div",{className:"item",onClick:()=>D(a.number),children:[e("div",{className:"title",children:t("APPS.PHONE.CONTACTS.MAIN")}),e("div",{className:"value",children:L(a.number)})]})}),(a.email||a.address)&&n("div",{className:"contact-info",children:[a.email&&n("div",{className:"item",onClick:()=>D(a.email),children:[e("div",{className:"title",children:t("APPS.PHONE.CONTACTS.EMAIL").toLowerCase()}),e("div",{className:"value",children:a.email})]}),a.address&&n("div",{className:"item",onClick:()=>D(a.address),children:[e("div",{className:"title",children:t("APPS.PHONE.CONTACTS.ADDRESS").toLowerCase()}),e("div",{className:"value",children:a.address})]})]}),e("div",{className:"contact-info",children:a.firstname?n(S,{children:[e("div",{className:"item",onClick:()=>{b.Share.set({type:"contact",data:{firstname:a.firstname,lastname:a.lastname,number:a.number,avatar:a.avatar??r.avatar}})},children:t("APPS.PHONE.CONTACTS.SHARE_CONTACT")}),!m&&n(S,{children:[e("div",{className:"item",onClick:()=>B(),children:t("APPS.PHONE.CONTACTS.SHARE_LOCATION")}),a.favourite?e("div",{className:"item red",onClick:()=>{g()},children:t("APPS.PHONE.CONTACTS.REMOVE_FAVORITE")}):e("div",{className:"item",onClick:()=>{g()},children:t("APPS.PHONE.CONTACTS.ADD_FAVORITE")})]})]}):e("div",{className:"item",onClick:()=>{h("NewContact")},children:t("APPS.PHONE.CONTACTS.ADD_CONTACT")})}),!m&&e("div",{className:"contact-info",children:a.blocked?e("div",{className:"item red",onClick:()=>{b.PopUp.set({title:t("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_TITLE"),description:t("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_TEXT").format({number:L(a.number)}),buttons:[{title:t("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_BUTTON_CANCEL")},{title:t("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_BUTTON_UNBLOCK"),cb:()=>{A()}}]})},children:t("APPS.PHONE.CONTACTS.UNBLOCK_CALLER")}):e("div",{className:"item red",onClick:()=>{b.PopUp.set({title:t("APPS.PHONE.CONTACTS.BLOCK_NUMBER_TITLE"),description:t("APPS.PHONE.CONTACTS.BLOCK_NUMBER_TEXT").format({number:L(a.number)}),buttons:[{title:t("APPS.PHONE.CONTACTS.BLOCK_NUMBER_BUTTON_CANCEL")},{title:t("APPS.PHONE.CONTACTS.BLOCK_NUMBER_BUTTON_BLOCK"),color:"red",cb:()=>{A()}}]})},children:t("APPS.PHONE.CONTACTS.BLOCK_CALLER")})})]})]})})})]})}function re(){const{View:P,viewContact:E}=N.useContext(I),r=T(f.Settings),[d,l]=P,C=T(f.PhoneNumber),u=T(O.APPS.PHONE.contacts),h=[],[a,c]=N.useState("");return n("div",{className:"slide right",children:[n("div",{className:"contacts-header",children:[n("div",{className:"items",children:[e("div",{className:"title",children:t("APPS.PHONE.CONTACTS.TITLE")}),e(Z,{onClick:()=>{l("NewContact")}})]}),e(q,{placeholder:t("SEARCH"),onChange:o=>c(o.target.value)})]}),n("div",{className:"content",children:[e("div",{className:"letters",children:[...Array(26)].map((o,s)=>{let v=String.fromCharCode(s+65);return e("a",{children:v},s)})}),e("div",{className:"contact nohover",onClick:()=>{E({firstname:r==null?void 0:r.name,number:C},"Contacts")},children:n("div",{className:"profile",children:[r!=null&&r.avatar?e("img",{src:r==null?void 0:r.avatar,alt:"avatar"}):e("div",{className:"profile-image",children:r==null?void 0:r.name.split(" ").map(o=>{var s;return(s=o==null?void 0:o[0])==null?void 0:s.toUpperCase()}).join("")}),n("div",{className:"profile-info",children:[e("div",{className:"name",children:r==null?void 0:r.name}),e("div",{className:"info",children:t("APPS.PHONE.CONTACTS.MY_CARD")})]})]})}),u&&n(S,{children:[u.filter(o=>k(o.firstname,o.lastname).toLowerCase().includes(a.toLowerCase())).sort((o,s)=>o.firstname.localeCompare(s.firstname)).map((o,s)=>{let v=o.firstname.charAt(0).toUpperCase();return h.includes(v)?e("div",{className:"contact border",onClick:()=>E(o,"Contacts"),children:k(o.firstname,o.lastname)}):(h.push(v),n("div",{children:[e("div",{id:v,className:`divider ${h.length==1?"no-border":""}`,children:v}),e("div",{className:"contact border",onClick:()=>E(o,"Contacts"),children:k(o.firstname,o.lastname)})]},s))}),n("div",{className:"total-contacts",children:[u.length," ",t("APPS.PHONE.CONTACTS.TITLE")]})]})]})]})}function oe(){const{viewContact:P}=N.useContext(I),E=T(O.APPS.PHONE.contacts),[r,d]=N.useState(!1);return n("div",{className:"slide right",children:[e("div",{className:"contacts-header",children:n("div",{className:"items",children:[e("div",{className:"title",children:t("APPS.PHONE.FAVOURITES.TITLE")}),e("span",{onClick:()=>d(!r),children:r?t("APPS.PHONE.DONE"):t("APPS.PHONE.EDIT")})]})}),e("div",{className:"content",children:e("div",{className:"favourite",children:E.filter(l=>l.favourite||l.company).sort((l,C)=>l.company?-1:1).map((l,C)=>{let u=k(l.firstname,l.lastname);return n("div",{className:"item",onClick:()=>{b.PopUp.set({title:t("APPS.PHONE.CALL.CALL_TITLE").format({name:u}),description:t("APPS.PHONE.CALL.CALL_TEXT").format({name:u}),buttons:[{title:t("APPS.PHONE.CALL.CALL_BUTTON_CANCEL")},{title:t("APPS.PHONE.CALL.CALL_BUTTON_CALL"),cb:()=>{w({number:l.number,company:l.company,companylabel:l.firstname})}}]})},children:[n("div",{className:"user",children:[r&&!l.company&&e(z,{onClick:h=>{h.stopPropagation(),b.PopUp.set({title:t("APPS.PHONE.FAVOURITES.REMOVE_TITLE"),description:t("APPS.PHONE.FAVOURITES.REMOVE_TEXT"),buttons:[{title:t("APPS.PHONE.FAVOURITES.REMOVE_BUTTON_CANCEL")},{title:t("APPS.PHONE.FAVOURITES.REMOVE_BUTTON_REMOVE"),color:"red",cb:()=>{p("Phone",{action:"toggleFavourite",number:l.number,favourite:!1}).then(a=>{O.APPS.PHONE.contacts.set(E.map(c=>c.number===l.number?{...c,favourite:!c.favourite}:c))})}}]})}}),l.avatar?e("div",{className:"avatar",style:{backgroundImage:`url(${l.avatar})`}}):e("div",{className:"avatar",children:V(l.firstname,l.lastname)}),n("div",{className:"info",children:[u,e("span",{children:L(l.number)})]})]}),e(Y,{onClick:h=>{h.stopPropagation(),P(l,"Favourites")}})]},C)})})})]})}function de(){const{View:P,Contact:E,viewContact:r}=N.useContext(I),[d,l]=P,[C,u]=E,[h,a]=N.useState(null),[c,o]=N.useState("");N.useEffect(()=>(document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)),[c]);const s=m=>{m=="delete"?o(c.slice(0,-1)):o(c+m)},v=m=>{if(m.key.match(/^[0-9]+$/))s(m.key);else switch(m.key){case"Backspace":s("delete");break;case"Enter":c.length>=3&&w({number:c});break}};return N.useEffect(()=>{if(c.length!==ee())return a(null);a(F(c))},[c]),e("div",{className:"slide right",children:e("div",{className:"content noscroll",children:n("div",{className:"keypad-container",children:[n("div",{className:"inputbox",children:[e("div",{className:"input",children:L(c)}),e("span",{onClick:()=>{if(o(""),h)r(h,"Keypad");else{let m=F(c);m?(u({...m,number:c}),l("NewContact")):(u({number:c}),l("NewContact"))}},children:c.length>0&&(h?h.name:t("APPS.PHONE.KEYPAD.ADD_NUMBER"))})]}),e("div",{className:"keypad-wrapper",children:n("div",{className:"keypad",children:[e("div",{onClick:()=>{s(1)},children:"1"}),n("div",{onClick:()=>{s(2)},children:["2",e("span",{children:"ABC"})]}),n("div",{onClick:()=>{s(3)},children:["3",e("span",{children:"DEF"})]}),n("div",{onClick:()=>{s(4)},children:["4",e("span",{children:"GHI"})]}),n("div",{onClick:()=>{s(5)},children:["5",e("span",{children:"JKL"})]}),n("div",{onClick:()=>{s(6)},children:["6",e("span",{children:"MNO"})]}),n("div",{onClick:()=>{s(7)},children:["7",e("span",{children:"PQRS"})]}),n("div",{onClick:()=>{s(8)},children:["8",e("span",{children:"TUV"})]}),n("div",{onClick:()=>{s(9)},children:["9",e("span",{children:"WYXZ"})]}),e("div",{children:"*"}),n("div",{onClick:()=>{s(0)},children:["0",e("span",{children:"+"})]}),e("div",{children:"#"}),e("span",{}),e("div",{className:"call",onClick:()=>{c.length>=3&&w({number:c})},children:e(j,{})}),e("div",{className:"delete",onClick:()=>s("delete"),children:e(ae,{})})]})})]})})})}function me(){const{Func:P}=N.useContext(ce),{View:E,Contact:r}=N.useContext(I),d=T(f.PhoneNumber),[l]=r,[C,u]=E,h=T(O.APPS.PHONE.contacts),a=T(f.Settings),[c,o]=P.TextColor;o(a.display.theme=="dark"?"#ffffff":"#000000");const[s,v]=N.useState(null),[m,R]=N.useState(!1);N.useEffect(()=>{l&&l.number&&v({...s,number:l.number})},[l]),N.useEffect(()=>{s&&R(s.firstname&&s.number!==void 0)},[s]);const M=()=>{if(s){if(!s.number||(s==null?void 0:s.number)===d)return u("Contacts");s.lastname=(s==null?void 0:s.lastname)??"",p("Phone",{action:"saveContact",data:s}).then(A=>{if(!A)return K("warning","Failed to save contact");O.APPS.PHONE.contacts.set([...h,s]),u("Contacts")})}};return n("div",{className:"slide up",children:[e("div",{className:"contacts-header",children:n("div",{className:"items",children:[e("div",{className:"back",onClick:()=>u("Contacts"),children:t("APPS.PHONE.CANCEL")}),e("span",{className:m?"":"disabled",onClick:()=>{m&&M()},children:t("APPS.PHONE.DONE")})]})}),e("div",{className:"content",children:e(S,{children:n("div",{className:"contact nohover",children:[e("div",{className:"user",onClick:()=>{var A,g,y;b.Gallery.set({allowExternal:(y=(g=(A=X)==null?void 0:A.value)==null?void 0:g.AllowExternal)==null?void 0:y.Other,onSelect:B=>v({...s,avatar:B.src})})},children:s!=null&&s.avatar?n(S,{children:[e("div",{className:"profile-image bigger transparent",style:{backgroundImage:`url(${s.avatar})`}}),e("span",{children:t("APPS.PHONE.EDIT")})]}):n(S,{children:[e(U,{className:"big"}),e("span",{className:"add",children:t("APPS.PHONE.CONTACTS.ADD_PHOTO")})]})}),n("div",{className:"contact-info",children:[e("div",{className:"item input",children:e(H,{type:"text",placeholder:t("APPS.PHONE.CONTACTS.FIRST_NAME"),onChange:A=>v({...s,firstname:A.target.value}),maxLength:20})}),e("div",{className:"item input",children:e(H,{type:"text",placeholder:t("APPS.PHONE.CONTACTS.LAST_NAME"),onChange:A=>v({...s,lastname:A.target.value}),maxLength:20})})]}),e("div",{className:"contact-info",children:e("div",{className:"item input",children:e(H,{className:"phone_number",type:"number",placeholder:t("APPS.PHONE.CONTACTS.PHONE_NUMBER"),defaultValue:l==null?void 0:l.number,maxLength:15,onChange:A=>{let g=A.target.value.slice(-1).charCodeAt(0);g>=48&&g<=57&&v({...s,number:A.target.value})}})})})]})})})]})}function Ne(){const{viewContact:P}=N.useContext(I),[E,r]=N.useState([]);return N.useEffect(()=>{p("Phone",{action:"getRecent",page:0}).then(d=>{d&&r(d)})},[]),n("div",{className:"slide right",children:[e("div",{className:"contacts-header",children:e("div",{className:"items",children:e("div",{className:"title",children:t("APPS.PHONE.RECENTS.TITLE")})})}),e("div",{className:"content",children:e("div",{className:"recent-calls",children:E.map((d,l)=>n("div",{className:`item${!d.called&&!d.answered?" missed":""}`,onClick:()=>{if(d.hideCallerId)return;let C;d.name?C=d.name:C=L(d.number),b.PopUp.set({title:t("APPS.PHONE.CALL.CALL_TITLE").format({name:C}),description:t("APPS.PHONE.CALL.CALL_TEXT").format({name:C}),buttons:[{title:t("APPS.PHONE.CALL.CALL_BUTTON_CANCEL")},{title:t("APPS.PHONE.CALL.CALL_BUTTON_CALL"),cb:()=>{w({number:d.number})}}]})},children:[e("div",{className:"user",children:d.hideCallerId?n(S,{children:[t("APPS.PHONE.CALL.NO_CALLER_ID"),e("span",{children:t("APPS.PHONE.CALL.UNKNOWN")})]}):d.name?n(S,{children:[d.name,e("span",{children:L(d.number)})]}):n(S,{children:[L(d.number),e("span",{children:t("APPS.PHONE.CALL.UNKNOWN")})]})}),n("div",{className:"info",children:[e("div",{className:"date",children:te(d.timestamp)}),e(Y,{onClick:C=>{if(C.stopPropagation(),d.hideCallerId)return K("info","Call info couldn't be loaded since user called with 'No Caller ID'");if(d.name){let u=F(d.number);u&&P({...u,number:d.number},"Recents")}else P({...d},"Recents")}})]})]},l))})})]})}const I=N.createContext(null);function Se(){const P=T(f.App),[E,r]=N.useState("Contacts"),[d,l]=N.useState(null),C=T(O.APPS.PHONE.contacts),u=(c,o)=>{l({...c,from:o}),r("Contact")};N.useEffect(()=>{if(C&&P!=null&&P.data)if(P.view==="contact"){let c=C==null?void 0:C.find(o=>o.number==P.data);if(!c)return;l({...c||{number:P.data},from:"Contacts"}),r("Contact")}else P.view==="newContact"&&(l({number:P.data,from:"Contacts"}),r("NewContact"))},[]);const h={Favourites:e(oe,{}),Contacts:e(re,{}),Recents:e(Ne,{}),Keypad:e(de,{}),NewContact:e(me,{}),Contact:e(le,{})},a={Favourites:e(ne,{}),Recents:e(se,{}),Contacts:e(U,{}),Keypad:e(ie,{})};return n("div",{className:"phone-app-container",children:[e(I.Provider,{value:{Contact:[d,l],View:[E,r],viewContact:u},children:e("div",{className:"wrapper",children:h[E]})}),e("div",{className:"footer",children:Object.keys(a).map((c,o)=>{let s=E==c?"active":"";return n("div",{className:`item ${s}`,onClick:()=>r(c),children:[a[c],e("span",{children:t(`APPS.PHONE.${c.toUpperCase()}.TITLE`)})]},o)})})]})}export{I as PhoneContext,Se as default};
