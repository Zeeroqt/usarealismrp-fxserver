import{r as f,j as v,a as N,F as V}from"./jsx-runtime-7cf68bf7.js";import{r as E}from"./index-13bc66ee.js";import{P as S}from"./Phone-d1a23bb8.js";import{f as y,d as i,u as m,$ as p,P as w}from"./PhoneProvider-fb5cb781.js";import"./color-e1a4c391.js";import"./index.esm-3a7b91c6.js";import"./AppStore-52953299.js";import"./Pin-e697d693.js";import"./number-28525126.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const e of o)if(e.type==="childList")for(const r of e.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function s(o){const e={};return o.integrity&&(e.integrity=o.integrity),o.referrerpolicy&&(e.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?e.credentials="include":o.crossorigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function a(o){if(o.ep)return;o.ep=!0;const e=s(o);fetch(o.href,e)}})();var g={},P=E;g.createRoot=P.createRoot,g.hydrateRoot=P.hydrateRoot;const x=()=>{const[t,c]=f.useState(null);return f.useEffect(()=>{y("voice:getConfig").then(s=>{if(!s)return i("error","VoiceProvider: No config found");c(s)})},[]),t!=null&&t.recordNearbyVoices?v(C,{config:t}):null},C=({config:t})=>{const c=f.useRef(null),[s,a]=f.useState([]),o=e=>{if(!c.current)return i("warning","VoiceProvider: No audio stream");i("info",`VoiceProvider: ${e?"muting":"umuting"} audio stream`),s.forEach(r=>{r.gainNode.gain.value=e?0:r.volume,i("info",`VoiceProvider: Set volume to ${e?0:r.volume} for channel ${r.id}`)})};return m("camera:toggleMicrophone",e=>{o(!e)}),f.useEffect(()=>{var e;return(e=navigator.mediaDevices)==null||e.getUserMedia({audio:!0}).then(r=>{c.current=r,i("info","VoiceProvider: Got audio stream")}),()=>{var r;s.forEach(n=>{n.peer.destroy()}),(r=c.current)==null||r.getTracks().forEach(n=>n.stop())}},[]),m("voice:joinChannel",e=>{if(!c.current)return i("warning","VoiceProvider: No audio stream");if(s.find(d=>d.id===e.channel))return i("warning","VoiceProvider: Already connected to channel "+e.channel);i("info","Joining voice channel "+JSON.stringify(e));let r=new AudioContext,n=r.createMediaStreamSource(c.current),l=r.createMediaStreamDestination(),u=r.createGain();u.gain.value=e.volume,n.connect(u),u.connect(l),y("isTalking").then(d=>{d||(u.gain.value=0)});const h=t!=null&&t.ice?new p({config:{iceTransportPolicy:"relay",iceServers:t==null?void 0:t.ice}}):new p;h.on("open",()=>{h.call(e.channel,l.stream),a(d=>[...d,{id:e.channel,volume:e.volume,peer:h,gainNode:u,audioCtx:r}])})}),m("voice:leaveChannel",e=>{i("info","Leaving voice channel "+e);const r=s.find(n=>n.id===e);if(!r)return i("warning","VoiceProvider: Not connected to channel "+e);r.audioCtx.close(),r.peer.destroy(),a(n=>n.filter(l=>l.id!==e))}),m("voice:setVolume",e=>{i("info","Setting volume for channel "+e.channel+" to "+e.volume);const r=s.find(n=>n.id===e.channel);if(!r)return i("warning","VoiceProvider: Not connected to channel "+e.channel);r.gainNode.gain.value=e.volume,a(n=>n.map(l=>l.id===e.channel?{...l,volume:e.volume}:l))}),null};g.createRoot(document.getElementById("root")).render(N(V,{children:[v(w,{children:v(S,{})}),v(x,{})]}));
