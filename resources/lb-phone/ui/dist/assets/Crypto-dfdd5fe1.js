import{r as a,a as C,j as o}from"./jsx-runtime-55b9ff2c.js";import{K as _,a1 as y,u as b,f as A,L as n,bo as Y,bp as U,v as w,bq as x,br as I,C as g,e as B,b as k}from"./Phone-aba84f0c.js";import{f as L,r as S}from"./number-28525126.js";function $({children:e,text:t}){const[d,h]=a.useState(!1);return C("div",{className:"tooltip-wrapper",onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),children:[e,o(_,{children:d&&o(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"tooltip top",children:o("div",{dangerouslySetInnerHTML:{__html:t}})})})]})}const N=a.createContext(null);function G(){var m;const e=b(B),t=b(k.Settings),[d,h]=a.useState(0),[p,T]=a.useState([]),[v,i]=a.useState(""),[r,P]=a.useState("0"),[s,l]=a.useState(t==null?void 0:t.streamerMode);a.useEffect(()=>{A("Crypto",{action:"get"}).then(c=>{c&&T(c)})},[]),a.useEffect(()=>h(p.reduce((c,O)=>c+(O.owned??0)*O.current_price,0)),[p]),a.useEffect(()=>{P(s?L("âˆ—".repeat(S(d,2).toString().length)):L(S(d,2)))},[d,s]);const u=c=>{let O={0:50,10:45,12:40,14:35},E=0;for(let f=0;f<Object.keys(O).length;f++)c.length>=parseInt(Object.keys(O)[f])&&(E=O[Object.keys(O)[f]]);return E};return C("div",{className:"crypto-container",children:[C("div",{className:"crypto-header",children:[o("img",{src:"./assets/img/icons/apps/Cryptopng.png",alt:"btc"}),n("APPS.CRYPTO.TITLE")]}),o(N.Provider,{value:{Coins:[p,T]},children:C("div",{className:"crypto-wrapper",children:[C("div",{className:"balance",children:[C("div",{className:"title",children:[n("APPS.CRYPTO.BALANCE"),o("div",{className:"icon",onClick:()=>l(!s),children:s?o(Y,{}):o(U,{})})]}),o("div",{className:"amount",style:{fontSize:u(r.toString())},onClick:()=>l(!s),children:(m=e==null?void 0:e.CurrencyFormat)==null?void 0:m.replace("%s",r.toString())})]}),o("div",{className:"search",children:o(w,{placeholder:"Search Cryptocurrency",onChange:c=>i(c.target.value)})}),o(D,{search:v}),o("div",{className:"credits",children:"Powered by CoinGecko"})]})})]})}const D=({search:e})=>{const[t,d]=a.useState("balance"),[h,p]=a.useState(!0),T=["Name","Graph","Balance"],[v]=a.useContext(N).Coins;return o("div",{className:"holdings",children:C("div",{className:"items",children:[o("div",{className:"item filters",children:T.map((i,r)=>C("div",{className:"filter",onClick:()=>{if(d(i.toLowerCase()),t===i.toLowerCase())return p(!h);p(!0)},children:[i,i.toLowerCase()===t&&h?o(x,{}):o(I,{})]},r))}),v.sort((i,r)=>t==="name"?h?i.name.localeCompare(r.name):r.name.localeCompare(i.name):t==="graph"?h?i.change_24h-r.change_24h:r.change_24h-i.change_24h:t==="balance"?h?(r.owned??0)*r.current_price-(i.owned??0)*i.current_price:(i.owned??0)*i.current_price-(r.owned??0)*r.current_price:0).filter(i=>i.name.toLowerCase().includes(e.toLowerCase())||i.symbol.toLowerCase().includes(e.toLowerCase())).map((i,r)=>o(j,{data:i},r))]})})},j=({data:e})=>{const[t,d]=a.useState(!1),[h,p]=a.useState(""),[T,v]=a.useContext(N).Coins,i=(P,s)=>{s>1?A("Crypto",{action:"buy",coin:P,amount:s}).then(l=>{if(l!=null&&l.success)return v(u=>u.map(m=>m.id===P?{...m,owned:(m.owned??0)+s/m.current_price,value:(m.value??0)+s,invested:(m.invested??0)+s}:m));l!=null&&l.msg&&setTimeout(()=>{g.PopUp.set({title:n("APPS.CRYPTO.ERROR"),description:n(`APPS.CRYPTO.${l.msg}`),buttons:[{title:n("APPS.CRYPTO.CLOSE")}]})},250)}):setTimeout(()=>{g.PopUp.set({title:n("APPS.CRYPTO.ERROR"),description:n("APPS.CRYPTO.ATLEAST_ONE_COIN").format({action:"buy"}),buttons:[{title:n("APPS.CRYPTO.CLOSE")}]})},250)},r=(P,s,l)=>{l>0?A("Crypto",{action:"sell",coin:P,amount:l}).then(u=>{if(u!=null&&u.success)return v(m=>m.map(c=>c.id===P?{...c,owned:(c.owned??0)-s/c.current_price,value:(c.value??0)+s,invested:(c.invested??0)-s}:c));u!=null&&u.msg&&setTimeout(()=>{g.PopUp.set({title:n("APPS.CRYPTO.ERROR"),description:n(`APPS.CRYPTO.${u.msg}`),buttons:[{title:n("APPS.CRYPTO.CLOSE")}]})},250)}):setTimeout(()=>{g.PopUp.set({title:n("APPS.CRYPTO.ERROR"),description:n("APPS.CRYPTO.ATLEAST_ONE_COIN").format({action:"sell"}),buttons:[{title:n("APPS.CRYPTO.CLOSE")}]})},250)};return e.symbol=e.symbol.toUpperCase(),e.owned=e.owned??0,e.value=e.current_price*(e.owned??0),C("div",{className:"item",onClick:()=>d(!t),children:[C("div",{className:"top",children:[C("div",{className:"info",children:[o("img",{src:e.image,className:"icon",alt:"Icon"}),C("div",{className:"coin",children:[o("div",{className:"name",children:e.symbol}),o("div",{className:"symbol",children:e.name})]})]}),o(F,{data:e}),C("div",{className:"amount",children:[o("div",{className:"value",children:L(S(e.owned,4))}),C("div",{className:"asset",children:["$",L(S(e.value,2))]})]})]}),o(_,{children:t&&C(y.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},className:"bottom",children:[o(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button fill",onClick:P=>{P.stopPropagation(),g.PopUp.set({title:n("APPS.CRYPTO.BUY_POPUP.TITLE").format({coin:e.symbol}),description:n("APPS.CRYPTO.BUY_POPUP.DESCRIPTION").format({coin:e.symbol}),input:{placeholder:n("APPS.CRYPTO.BUY_POPUP.PLACEHOLDER"),type:"number",value:0,onChange:s=>p(s)},buttons:[{title:n("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:n("APPS.CRYPTO.BUY_POPUP.PROCEED"),cb:()=>{p(s=>(i(e.id,parseFloat(s)),s))}}]})},children:n("APPS.CRYPTO.BUY")}),o(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button",onClick:P=>{P.stopPropagation(),g.PopUp.set({title:n("APPS.CRYPTO.SELL_POPUP.TITLE").format({coin:e.symbol}),description:n("APPS.CRYPTO.SELL_POPUP.DESCRIPTION").format({coin:e.symbol}),input:{placeholder:n("APPS.CRYPTO.BUY_POPUP.PLACEHOLDER"),type:"number",value:0,onChange:s=>p(s)},buttons:[{title:n("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:n("APPS.CRYPTO.BUY_POPUP.PROCEED"),cb:()=>{p(s=>{let l=parseFloat(s),u=l/e.current_price;return r(e.id,l,u),s})}}]})},children:n("APPS.CRYPTO.SELL")}),o(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button red",onClick:P=>{P.stopPropagation(),g.PopUp.set({title:n("APPS.CRYPTO.SELL_ALL_POPUP.TITLE").format({coin:e.symbol}),description:n("APPS.CRYPTO.SELL_ALL_POPUP.DESCRIPTION").format({coin:e.symbol,amount:e.owned*e.current_price}),buttons:[{title:n("APPS.CRYPTO.SELL_ALL_POPUP.CANCEL")},{title:n("APPS.CRYPTO.SELL_ALL_POPUP.PROCEED"),color:"red",cb:()=>{let s=e.owned*e.current_price;r(e.id,s,e.owned)}}]})},children:n("APPS.CRYPTO.SELL_ALL")})]})})]})},F=e=>{if(!(e!=null&&e.data.prices))return null;let t=e.data.prices;const d=a.useRef(null),[h,p]=a.useState(null),[T,v]=a.useState(null);return t=t.slice(0,24),a.useEffect(()=>{if(!(d!=null&&d.current))return;const i=d.current;i.width=150,i.height=100;const r=i.getContext("2d");r.lineWidth=3;const P=Math.min(...t),l=Math.max(...t)-P,u=i.height-10;let m=0,c=i.height-5-(t[0]-P)/l*u;r.beginPath(),r.moveTo(m,c);const O=t[t.length-1]-t[0]>0?"green":"red";r.strokeStyle=O;for(let R=1;R<t.length;R++)m+=i.width/(t.length-1),c=i.height-5-(t[R]-P)/l*u,r.lineTo(m,c);r.stroke();const E=(t[t.length-1]-t[0])/t[0]*100;E>0?p(`<div style="color: var(--phone-color-green)">+${S(E,2)}%</div>`):E<0?p(`<div style="color: var(--phone-color-red)">${S(E,2)}%</div>`):p(`<div>${S(E,2)}%</div>`);let f=(e.data.value-e.data.invested)/e.data.invested*100;f>0?v(`<div style="color: var(--phone-color-green)">+${S(f,2)}%</div>`):f<0&&v(`<div style="color: var(--phone-color-red)">${S(f,2)}%</div>`)},[d,t]),o($,{text:`$${S(e.data.current_price,2)} ${h??""} ${T??""}`,children:o("canvas",{ref:d})})};export{G as default};
