import{r as m,a as n,j as e,F as S}from"./jsx-runtime-7cf68bf7.js";import{b as T,L as t,C as b,h as $,i as V,I as w,j as I,k as _,m as L,c as f,n as W,o as U,p as G,q,r as z,t as O,f as p,d as X,v as J,w as Q,x as Z,y as j,z as ee,A as D,B as ae,D as te,E as ne,F as se,G as ie,H as ce}from"./Phone-e1d97322.js";import{r as K}from"./number-28525126.js";function le(){const{View:P,Contact:v}=m.useContext(k),r=T(f.Settings),d=T(f.PhoneNumber),[c,C]=m.useState(null),[u,h]=P,[a,i]=v,o=T(O.APPS.PHONE.contacts),[s,E]=m.useState(!1),[N,y]=m.useState(!1);m.useEffect(()=>C(a.number),[]);const M=()=>{p("Phone",{action:"removeContact",number:a.number}).then(()=>{O.APPS.PHONE.contacts.set(o.filter(l=>l.number!==a.number)),i(null),h("Contacts")})},A=()=>{p("Phone",{action:"toggleBlock",number:a.number,blocked:!a.blocked}).then(()=>{i({...a,blocked:!a.blocked}),O.APPS.PHONE.contacts.set(o.map(l=>l.number===a.number?{...l,blocked:!l.blocked}:l))})},g=()=>{p("Phone",{action:"toggleFavourite",number:a.number,favourite:!a.favourite}).then(()=>{i({...a,favourite:!a.favourite}),O.APPS.PHONE.contacts.set(o.map(l=>l.number===a.number?{...l,favourite:!l.favourite}:l))})},R=()=>{if(!a.number||a.number.length===0)return h("Contacts");a.number===d?(f.Settings.patch({name:a.firstname,avatar:a.avatar??r.avatar}),p("setPhoneName",a.firstname),p("setSettings",f.Settings.value),E(l=>!l),O.APPS.PHONE.contacts.set(o.map(l=>l.number===a.number?{...l,...a}:l))):(a.lastname=a.lastname??"",p("Phone",{action:"updateContact",data:{...a,oldNumber:c}}).then(()=>{E(l=>!l),O.APPS.PHONE.contacts.set(o.map(l=>l.number===a.number?{...l,...a}:l)),C(a.number)}))},B=()=>{a&&b.PopUp.set({title:t("APPS.MESSAGES.SEND_LOCATION_POPUP.TITLE"),description:t("APPS.MESSAGES.SEND_LOCATION_POPUP.TEXT"),buttons:[{title:t("APPS.MESSAGES.SEND_LOCATION_POPUP.CANCEL")},{title:t("APPS.MESSAGES.SEND_LOCATION_POPUP.SEND"),cb:()=>{p("Maps",{action:"getCurrentLocation"}).then(l=>{l&&p("Messages",{action:"sendMessage",number:a.number,content:`<!SENT-LOCATION-X=${K(l.x,2)}Y=${K(l.y,2)}!>`,attachments:[]}).then(H=>{H?f.App.set({name:"Messages",data:{number:a.number,name:a.firstname&&_(a.firstname,a.lastname),avatar:a.avatar},view:"messages"}):X("warning","something went wrong while sending location")})})}}]})},x=m.useRef(!0);return m.useEffect(()=>{x.current&&x.current&&(C(a.number),x.current=!1,y(a.number===d))},[a]),n("div",{className:"slide left",children:[e("div",{className:"contacts-header",children:n("div",{className:"items",children:[s?e("span",{}):n("div",{className:"back",onClick:()=>{h(a.from),i(null)},children:[e("i",{className:"fal fa-chevron-left"}),t(`APPS.PHONE.${a.from.toUpperCase()}.TITLE`)]}),a.firstname&&!a.company&&e("span",{onClick:()=>{s?R():E(l=>!l)},children:s?t("APPS.PHONE.DONE"):t("APPS.PHONE.EDIT")})]})}),e("div",{className:"content",children:s?e(S,{children:n("div",{className:"contact nohover",children:[n("div",{className:"user",onClick:()=>{var l,H,F;b.Gallery.set({allowExternal:(F=(H=(l=$)==null?void 0:l.value)==null?void 0:H.AllowExternal)==null?void 0:F.Other,onSelect:Y=>i({...a,avatar:Y.src})})},children:[a.avatar||N&&r.avatar?e("div",{className:"profile-image bigger",style:{backgroundImage:`url(${a.avatar??r.avatar})`}}):a.firstname?e("div",{className:"profile-image bigger",children:V(a.firstname,a.lastname)}):e(w,{}),e("span",{children:t("APPS.PHONE.EDIT")})]}),n("div",{className:"contact-info",children:[e("div",{className:"item input",children:e(I,{type:"text",placeholder:t("APPS.PHONE.CONTACTS.FIRST_NAME"),value:a.firstname,onChange:l=>i({...a,firstname:l.target.value}),maxLength:20})}),!N&&e("div",{className:"item input",children:e(I,{type:"text",placeholder:t("APPS.PHONE.CONTACTS.LAST_NAME"),value:a.lastname??"",onChange:l=>i({...a,lastname:l.target.value}),maxLength:20})})]}),e("div",{className:"contact-info",children:e("div",{className:"item input",children:e(I,{className:"phone_number",type:"number",placeholder:t("APPS.PHONE.CONTACTS.PHONE_NUMBER"),defaultValue:a==null?void 0:a.number,maxLength:20,disabled:N,onChange:l=>{if(N)return;let H=l.target.value.slice(-1).charCodeAt(0);H>=48&&H<=57&&l.target.value.length<=10&&i({...a,number:l.target.value})}})})}),!N&&e("div",{className:"contact-info",children:e("div",{className:"item red",onClick:()=>{b.PopUp.set({title:t("APPS.PHONE.CONTACTS.REMOVE_CONTACT_TITLE"),description:t("APPS.PHONE.CONTACTS.REMOVE_CONTACT_TEXT"),buttons:[{title:t("APPS.PHONE.CONTACTS.REMOVE_CONTACT_BUTTON_CANCEL")},{title:t("APPS.PHONE.CONTACTS.REMOVE_CONTACT_BUTTON_DELETE"),color:"red",cb:M}]})},children:t("APPS.PHONE.CONTACTS.DELETE_CONTACT")})})]})}):e(S,{children:n("div",{className:"contact nohover details",children:[n("div",{className:"user",children:[a.avatar||N&&r.avatar?e("div",{className:"profile-image bigger",style:{backgroundImage:`url(${N?r.avatar:a.avatar})`}}):a.firstname?e("div",{className:"profile-image bigger",children:V(a.firstname,a.lastname)}):e(w,{}),e("div",{className:"name",children:a.firstname?_(a.firstname,a.lastname):L(a.number)})]}),n("div",{className:"actions",children:[n("div",{className:"item","data-disabled":!!(N||a.company),onClick:()=>{f.App.set({name:"Messages",data:{number:a.number,name:a.firstname&&_(a.firstname,a.lastname),avatar:a.avatar},view:"messages"})},children:[e(W,{}),t("APPS.PHONE.CONTACTS.MESSAGE")]}),n("div",{className:"item call","data-disabled":N,onClick:()=>{U({number:a.number,company:a.company,companylabel:a.company&&a.firstname})},children:[e(G,{}),t("APPS.PHONE.CONTACTS.CALL")]}),n("div",{className:"item","data-disabled":!!(N||a.company),onClick:()=>{U({number:a.number,company:a.company,companylabel:a.company&&a.firstname,videoCall:!0})},children:[e(q,{}),t("APPS.PHONE.CONTACTS.VIDEO")]})]}),!a.company&&n(S,{children:[e("div",{className:"contact-info",children:n("div",{className:"item",onClick:()=>z(a.number),children:[e("div",{className:"title",children:t("APPS.PHONE.CONTACTS.MAIN")}),e("div",{className:"value",children:L(a.number)})]})}),e("div",{className:"contact-info",children:a.firstname?n(S,{children:[e("div",{className:"item",onClick:()=>{b.Share.set({type:"contact",data:{firstname:a.firstname,lastname:a.lastname,number:a.number,avatar:a.avatar??r.avatar}})},children:t("APPS.PHONE.CONTACTS.SHARE_CONTACT")}),!N&&n(S,{children:[e("div",{className:"item",onClick:()=>B(),children:t("APPS.PHONE.CONTACTS.SHARE_LOCATION")}),a.favourite?e("div",{className:"item red",onClick:()=>{g()},children:t("APPS.PHONE.CONTACTS.REMOVE_FAVORITE")}):e("div",{className:"item",onClick:()=>{g()},children:t("APPS.PHONE.CONTACTS.ADD_FAVORITE")})]})]}):e("div",{className:"item",onClick:()=>{h("NewContact")},children:t("APPS.PHONE.CONTACTS.ADD_CONTACT")})}),!N&&e("div",{className:"contact-info",children:a.blocked?e("div",{className:"item red",onClick:()=>{b.PopUp.set({title:t("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_TITLE"),description:t("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_TEXT").format({number:L(a.number)}),buttons:[{title:t("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_BUTTON_CANCEL")},{title:t("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_BUTTON_UNBLOCK"),cb:()=>{A()}}]})},children:t("APPS.PHONE.CONTACTS.UNBLOCK_CALLER")}):e("div",{className:"item red",onClick:()=>{b.PopUp.set({title:t("APPS.PHONE.CONTACTS.BLOCK_NUMBER_TITLE"),description:t("APPS.PHONE.CONTACTS.BLOCK_NUMBER_TEXT").format({number:L(a.number)}),buttons:[{title:t("APPS.PHONE.CONTACTS.BLOCK_NUMBER_BUTTON_CANCEL")},{title:t("APPS.PHONE.CONTACTS.BLOCK_NUMBER_BUTTON_BLOCK"),color:"red",cb:()=>{A()}}]})},children:t("APPS.PHONE.CONTACTS.BLOCK_CALLER")})})]})]})})})]})}function re(){const{View:P,viewContact:v}=m.useContext(k),r=T(f.Settings),[d,c]=P,C=T(f.PhoneNumber),u=T(O.APPS.PHONE.contacts),h=[],[a,i]=m.useState("");return n("div",{className:"slide right",children:[n("div",{className:"contacts-header",children:[n("div",{className:"items",children:[e("div",{className:"title",children:t("APPS.PHONE.CONTACTS.TITLE")}),e(J,{onClick:()=>{c("NewContact")}})]}),e(Q,{placeholder:t("SEARCH"),onChange:o=>i(o.target.value)})]}),n("div",{className:"content",children:[e("div",{className:"letters",children:[...Array(26)].map((o,s)=>{let E=String.fromCharCode(s+65);return e("a",{children:E},s)})}),e("div",{className:"contact nohover",onClick:()=>{v({firstname:r==null?void 0:r.name,number:C},"Contacts")},children:n("div",{className:"profile",children:[r!=null&&r.avatar?e("img",{src:r==null?void 0:r.avatar,alt:"avatar"}):e("div",{className:"profile-image",children:r==null?void 0:r.name.split(" ").map(o=>{var s;return(s=o==null?void 0:o[0])==null?void 0:s.toUpperCase()}).join("")}),n("div",{className:"profile-info",children:[e("div",{className:"name",children:r==null?void 0:r.name}),e("div",{className:"info",children:t("APPS.PHONE.CONTACTS.MY_CARD")})]})]})}),u&&n(S,{children:[u.filter(o=>_(o.firstname,o.lastname).toLowerCase().includes(a.toLowerCase())).sort((o,s)=>o.firstname.localeCompare(s.firstname)).map((o,s)=>{let E=o.firstname.charAt(0).toUpperCase();return h.includes(E)?e("div",{className:"contact border",onClick:()=>v(o,"Contacts"),children:_(o.firstname,o.lastname)}):(h.push(E),n("div",{children:[e("div",{id:E,className:`divider ${h.length==1?"no-border":""}`,children:E}),e("div",{className:"contact border",onClick:()=>v(o,"Contacts"),children:_(o.firstname,o.lastname)})]},s))}),n("div",{className:"total-contacts",children:[u.length," ",t("APPS.PHONE.CONTACTS.TITLE")]})]})]})]})}function oe(){const{viewContact:P}=m.useContext(k),v=T(O.APPS.PHONE.contacts),[r,d]=m.useState(!1);return n("div",{className:"slide right",children:[e("div",{className:"contacts-header",children:n("div",{className:"items",children:[e("div",{className:"title",children:t("APPS.PHONE.FAVOURITES.TITLE")}),e("span",{onClick:()=>d(!r),children:r?t("APPS.PHONE.DONE"):t("APPS.PHONE.EDIT")})]})}),e("div",{className:"content",children:e("div",{className:"favourite",children:v.filter(c=>c.favourite||c.company).sort((c,C)=>c.company?-1:1).map((c,C)=>{let u=_(c.firstname,c.lastname);return n("div",{className:"item",onClick:()=>{b.PopUp.set({title:t("APPS.PHONE.CALL.CALL_TITLE").format({name:u}),description:t("APPS.PHONE.CALL.CALL_TEXT").format({name:u}),buttons:[{title:t("APPS.PHONE.CALL.CALL_BUTTON_CANCEL")},{title:t("APPS.PHONE.CALL.CALL_BUTTON_CALL"),cb:()=>{U({number:c.number,company:c.company,companylabel:c.firstname})}}]})},children:[n("div",{className:"user",children:[r&&!c.company&&e(Z,{onClick:h=>{h.stopPropagation(),b.PopUp.set({title:t("APPS.PHONE.FAVOURITES.REMOVE_TITLE"),description:t("APPS.PHONE.FAVOURITES.REMOVE_TEXT"),buttons:[{title:t("APPS.PHONE.FAVOURITES.REMOVE_BUTTON_CANCEL")},{title:t("APPS.PHONE.FAVOURITES.REMOVE_BUTTON_REMOVE"),color:"red",cb:()=>{p("Phone",{action:"toggleFavourite",number:c.number,favourite:!1}).then(a=>{O.APPS.PHONE.contacts.set(v.map(i=>i.number===c.number?{...i,favourite:!i.favourite}:i))})}}]})}}),c.avatar?e("div",{className:"avatar",style:{backgroundImage:`url(${c.avatar})`}}):e("div",{className:"avatar",children:V(c.firstname,c.lastname)}),n("div",{className:"info",children:[u,e("span",{children:L(c.number)})]})]}),e(j,{onClick:h=>{h.stopPropagation(),P(c,"Favourites")}})]},C)})})})]})}function de(){const{View:P,Contact:v,viewContact:r}=m.useContext(k),[d,c]=P,[C,u]=v,[h,a]=m.useState(null),[i,o]=m.useState("");m.useEffect(()=>(document.addEventListener("keydown",E),()=>document.removeEventListener("keydown",E)),[i]);const s=N=>{N=="delete"?o(i.slice(0,-1)):o(i+N)},E=N=>{if(N.key.match(/^[0-9]+$/))s(N.key);else switch(N.key){case"Backspace":s("delete");break;case"Enter":i.length>=3&&U({number:i});break}};return m.useEffect(()=>{if(i.length!==ee())return a(null);a(D(i))},[i]),e("div",{className:"slide right",children:e("div",{className:"content noscroll",children:n("div",{className:"keypad-container",children:[n("div",{className:"inputbox",children:[e("div",{className:"input",children:L(i)}),e("span",{onClick:()=>{if(o(""),h)r(h,"Keypad");else{let N=D(i);N?(u({...N,number:i}),c("NewContact")):(u({number:i}),c("NewContact"))}},children:i.length>0&&(h?h.name:t("APPS.PHONE.KEYPAD.ADD_NUMBER"))})]}),e("div",{className:"keypad-wrapper",children:n("div",{className:"keypad",children:[e("div",{onClick:()=>{s(1)},children:"1"}),n("div",{onClick:()=>{s(2)},children:["2",e("span",{children:"ABC"})]}),n("div",{onClick:()=>{s(3)},children:["3",e("span",{children:"DEF"})]}),n("div",{onClick:()=>{s(4)},children:["4",e("span",{children:"GHI"})]}),n("div",{onClick:()=>{s(5)},children:["5",e("span",{children:"JKL"})]}),n("div",{onClick:()=>{s(6)},children:["6",e("span",{children:"MNO"})]}),n("div",{onClick:()=>{s(7)},children:["7",e("span",{children:"PQRS"})]}),n("div",{onClick:()=>{s(8)},children:["8",e("span",{children:"TUV"})]}),n("div",{onClick:()=>{s(9)},children:["9",e("span",{children:"WYXZ"})]}),e("div",{children:"*"}),n("div",{onClick:()=>{s(0)},children:["0",e("span",{children:"+"})]}),e("div",{children:"#"}),e("span",{}),e("div",{className:"call",onClick:()=>{i.length>=3&&U({number:i})},children:e(G,{})}),e("div",{className:"delete",onClick:()=>s("delete"),children:e(ae,{})})]})})]})})})}function me(){const{Func:P}=m.useContext(te),{View:v,Contact:r}=m.useContext(k),d=T(f.PhoneNumber),[c]=r,[C,u]=v,h=T(O.APPS.PHONE.contacts),a=T(f.Settings),[i,o]=P.TextColor;o(a.display.theme=="dark"?"#ffffff":"#000000");const[s,E]=m.useState(null),[N,y]=m.useState(!1);m.useEffect(()=>{c&&c.number&&E({...s,number:c.number})},[c]),m.useEffect(()=>{s&&(s.firstname&&s.number?y(!0):y(!1))},[s]);const M=()=>{if(s){if(!s.number||(s==null?void 0:s.number)===d)return u("Contacts");s.lastname=(s==null?void 0:s.lastname)??"",p("Phone",{action:"saveContact",data:s}).then(A=>{A&&(O.APPS.PHONE.contacts.set([...h,s]),u("Contacts"))})}};return n("div",{className:"slide up",children:[e("div",{className:"contacts-header",children:n("div",{className:"items",children:[e("div",{className:"back",onClick:()=>{u("Contacts")},children:t("APPS.PHONE.CANCEL")}),e("span",{className:N?"":"disabled",onClick:()=>{N&&M()},children:t("APPS.PHONE.DONE")})]})}),e("div",{className:"content",children:e(S,{children:n("div",{className:"contact nohover",children:[e("div",{className:"user",onClick:()=>{var A,g,R;b.Gallery.set({allowExternal:(R=(g=(A=$)==null?void 0:A.value)==null?void 0:g.AllowExternal)==null?void 0:R.Other,onSelect:B=>E({...s,avatar:B.src})})},children:s!=null&&s.avatar?n(S,{children:[e("div",{className:"profile-image bigger transparent",style:{backgroundImage:`url(${s.avatar})`}}),e("span",{children:t("APPS.PHONE.EDIT")})]}):n(S,{children:[e(w,{className:"big"}),e("span",{className:"add",children:t("APPS.PHONE.CONTACTS.ADD_PHOTO")})]})}),n("div",{className:"contact-info",children:[e("div",{className:"item input",children:e(I,{type:"text",placeholder:t("APPS.PHONE.CONTACTS.FIRST_NAME"),onChange:A=>E({...s,firstname:A.target.value}),maxLength:20})}),e("div",{className:"item input",children:e(I,{type:"text",placeholder:t("APPS.PHONE.CONTACTS.LAST_NAME"),onChange:A=>E({...s,lastname:A.target.value}),maxLength:20})})]}),e("div",{className:"contact-info",children:e("div",{className:"item input",children:e(I,{className:"phone_number",type:"number",placeholder:t("APPS.PHONE.CONTACTS.PHONE_NUMBER"),defaultValue:c==null?void 0:c.number,maxLength:15,onChange:A=>{let g=A.target.value.slice(-1).charCodeAt(0);g>=48&&g<=57&&E({...s,number:A.target.value})}})})})]})})})]})}function Ne(){const{viewContact:P}=m.useContext(k),[v,r]=m.useState([]);return m.useEffect(()=>{p("Phone",{action:"getRecent",page:0}).then(d=>{d&&r(d)})},[]),n("div",{className:"slide right",children:[e("div",{className:"contacts-header",children:e("div",{className:"items",children:e("div",{className:"title",children:t("APPS.PHONE.RECENTS.TITLE")})})}),e("div",{className:"content",children:e("div",{className:"recent-calls",children:v.map((d,c)=>n("div",{className:`item${!d.called&&!d.answered?" missed":""}`,onClick:()=>{if(d.hideCallerId)return;let C;d.name?C=d.name:C=L(d.number),b.PopUp.set({title:t("APPS.PHONE.CALL.CALL_TITLE").format({name:C}),description:t("APPS.PHONE.CALL.CALL_TEXT").format({name:C}),buttons:[{title:t("APPS.PHONE.CALL.CALL_BUTTON_CANCEL")},{title:t("APPS.PHONE.CALL.CALL_BUTTON_CALL"),cb:()=>{U({number:d.number})}}]})},children:[e("div",{className:"user",children:d.hideCallerId?n(S,{children:[t("APPS.PHONE.CALL.NO_CALLER_ID"),e("span",{children:t("APPS.PHONE.CALL.UNKNOWN")})]}):d.name?n(S,{children:[d.name,e("span",{children:L(d.number)})]}):n(S,{children:[L(d.number),e("span",{children:t("APPS.PHONE.CALL.UNKNOWN")})]})}),n("div",{className:"info",children:[e("div",{className:"date",children:ne(d.timestamp)}),e(j,{onClick:C=>{if(C.stopPropagation(),d.hideCallerId)return X("info","Call info couldn't be loaded since user called with 'No Caller ID'");if(d.name){let u=D(d.number);u&&P({...u,number:d.number},"Recents")}else P({...d},"Recents")}})]})]},c))})})]})}const k=m.createContext(null);function ue(){const P=T(f.App),[v,r]=m.useState("Contacts"),[d,c]=m.useState(null),C=T(O.APPS.PHONE.contacts),u=(i,o)=>{c({...i,from:o}),r("Contact")};m.useEffect(()=>{if(C&&P!=null&&P.data)if(P.view==="contact"){let i=C==null?void 0:C.find(o=>o.number==P.data);if(!i)return;c({...i||{number:P.data},from:"Contacts"}),r("Contact")}else P.view==="newContact"&&(c({number:P.data,from:"Contacts"}),r("NewContact"))},[]);const h={Favourites:e(oe,{}),Contacts:e(re,{}),Recents:e(Ne,{}),Keypad:e(de,{}),NewContact:e(me,{}),Contact:e(le,{})},a={Favourites:e(se,{}),Recents:e(ie,{}),Contacts:e(w,{}),Keypad:e(ce,{})};return n("div",{className:"phone-app-container",children:[e(k.Provider,{value:{Contact:[d,c],View:[v,r],viewContact:u},children:e("div",{className:"wrapper",children:h[v]})}),e("div",{className:"footer",children:Object.keys(a).map((i,o)=>{let s=v==i?"active":"";return n("div",{className:`item ${s}`,onClick:()=>r(i),children:[a[i],e("span",{children:t(`APPS.PHONE.${i.toUpperCase()}.TITLE`)})]},o)})})]})}export{k as PhoneContext,ue as default};
