import{r as a,j as s,a as E,F as b}from"./jsx-runtime-f40812bf.js";import{f as C,L as m,aw as _,C as N,W as H,b as A,M as k,a2 as D,I as B,ax as U,h as X,c as x,ay as F}from"./Phone-bbdfbfe1.js";import{r as z}from"./number-28525126.js";import{C as V}from"./Check-ebaab325.js";function J(){const f=a.useRef(null),[v,S]=a.useState(!1),[r,P]=a.useState([]),[d,T]=a.useState(null),[u,p]=a.useState([]),[g,y]=a.useState(0),[i,O]=a.useState(!1),[w,L]=a.useState(!1);a.useEffect(()=>{C("Camera",{action:"getImages",page:0,filter:{showVideos:!0,showPhotos:!0}}).then(c=>{c&&p(c.reverse())})},[]);const n=c=>{if(w||i)return;let l=document.querySelector("#last");if(!l)return;!H(l)&&(O(!0),C("Camera",{action:"getImages",page:g+1,filter:{showVideos:!0,showPhotos:!0}}).then(t=>{t&&t.length>0?(p([...t.reverse(),...u]),O(!1),t.length<25&&L(!0)):L(!0)}),y(t=>t+1))},h=c=>{if(c){let l=u.filter(e=>e.src===c)[0];C("Camera",{action:"deleteFromGallery",links:l.src}).then(()=>{p(u.filter(e=>e.src!==c)),T(null),window.postMessage({action:"phone:updateStorage",add:!1,size:l.size})})}else C("Camera",{action:"deleteFromGallery",links:r.map(l=>l.src)}).then(()=>{p(u.filter(e=>!r.find(t=>e.src===t.src))),P([]);let l=0;r.forEach(e=>{l+=e.size}),window.postMessage({action:"phone:updateStorage",add:!1,size:l})})};return s("div",{className:"photos-container",children:d?s(G,{image:d,images:u,setActiveImage:T,handleDelete:h}):E("div",{className:"zoomOut",children:[E("div",{className:"photos-header",children:[s("div",{}),s("div",{className:"title",children:m("APPS.PHOTOS.TITLE")}),s("div",{className:"select",onClick:()=>S(!v),children:v?m("APPS.PHOTOS.CANCEL"):m("APPS.PHOTOS.SELECT")})]}),E("div",{className:"photos-content",onScroll:n,children:[s("div",{className:"info",children:m("APPS.PHOTOS.PHOTO_COUNT").format({count:u.length})}),s("div",{className:"images",ref:f,children:u.map((c,l)=>{let e=l===u.length-1?"last":"";return E("div",{id:e,className:"image",onClick:()=>{if(v){const t=r.find(o=>o.src===c.src);P(t?r.filter(o=>o.src!==c.src):[...r,c])}else T(c)},children:[c.isVideo?s(R,{src:c.src,editMode:v}):s("div",{className:"img",style:{backgroundImage:`url(${c.src})`}}),s("div",{className:"checkbox",children:v&&(r.find(t=>t.src===c.src)?s(V,{checked:!0}):s(V,{checked:!1}))})]},l)})})]}),v&&E("div",{className:"photos-bottom",children:[s("span",{}),s("div",{className:"selected",children:r.length>0?m("APPS.PHOTOS.SELECTED_COUNT").format({count:r.length}):m("APPS.PHOTOS.SELECT_ITEMS")}),r.length>0?s(_,{onClick:()=>{N.PopUp.set({title:m("APPS.PHOTOS.DELETE_TITLE").format({count:r.length}),description:m("APPS.PHOTOS.DELETE_TEXT").format({count:r.length}),buttons:[{title:m("APPS.PHOTOS.DELETE_BUTTON_CANCEL")},{title:m("APPS.PHOTOS.DELETE_BUTTON_DELETE"),color:"red",cb:()=>{h()}}]})}}):s("span",{})]})]})})}const G=f=>{var l;const v=A(X),S=A(x.Settings),[r,P]=a.useState(new Date(((l=f==null?void 0:f.image)==null?void 0:l.timestamp)/1e3)),[d,T]=a.useState(!0),[u,p]=a.useState(0),g=a.useRef(null),y=a.useRef(null),[i,O]=a.useState(f.image),[w,L]=a.useState([]);let n=f.images;a.useEffect(()=>{if(i&&i.isVideo){const e=document.getElementById(i.src);if(!e)return;e.volume=S.sound.volume}},[S.sound.volume]),a.useEffect(()=>{var t;let e=n.findIndex(o=>o.src===i.src);if(p(e),i.isVideo){const o=document.getElementById(i.src);if(!o)return;o.play(),o.volume=S.sound.volume}if(n.length>0){let o=[];e===0?o=n.slice(0,12):e===n.length-1?o=n.slice(n.length-12,n.length):e<6?o=n.slice(0,12):e>n.length-6?o=n.slice(n.length-12,n.length):o=n.slice(e-6,e+6),P(new Date(((t=n==null?void 0:n[e])==null?void 0:t.timestamp)/1e3)),L(o)}},[i]);const h={pos:{startLeft:0,startX:0},onMouseDown:e=>{h.pos={startLeft:g.current.scrollLeft,startX:e.clientX},g.current.style.userSelect="none",document.addEventListener("mouseup",h.onMouseUp),document.addEventListener("mousemove",h.onMove)},onMove:e=>{if(!g.current)return;const t=(e.clientX-h.pos.startX)/F(S.display.size);g.current.scrollLeft=h.pos.startLeft-t;const o=g.current.getBoundingClientRect();(o.left-5>e.clientX||e.clientX>o.right-5)&&h.onMouseUp()},onMouseUp:()=>{if(!g.current)return;g.current.style.removeProperty("user-select"),document.removeEventListener("mouseup",h.onMouseUp),document.removeEventListener("mousemove",h.onMove);const e=g.current.clientWidth;let t=u;const o=g.current.scrollLeft-h.pos.startLeft;if(o>e/2&&t<n.length?t++:o<-e/2&&t>0&&t--,i.src!==n[t].src&&i.isVideo){const M=document.getElementById(i.src);M&&(M.pause(),M.currentTime=0)}O(n[t]),document.getElementById(n[t].src).scrollIntoView({behavior:"smooth",block:"center"})}},c=e=>{i.isVideo&&document.getElementById(i.src).pause(),O(e),document.getElementById(e.src).scrollIntoView({behavior:"smooth",block:"center"})};return E("div",{className:"activephoto-container",children:[s(k,{children:d&&E(D.div,{className:"photo-top",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},children:[s("div",{className:"back",onClick:()=>{N.Share.reset(),f.setActiveImage(null)},children:s(B,{})}),E("div",{className:"date",children:[r.toLocaleString([],{day:"2-digit",month:"long"}),s("span",{children:r.toLocaleTimeString(v.DateLocale,{hour:"numeric",minute:"numeric",hour12:S.time.twelveHourClock})})]}),s("div",{})]})}),s("div",{className:"image-overflow",ref:g,onMouseDown:h.onMouseDown,onClick:()=>T(!d),children:n.map((e,t)=>{const o=e.src===i.src;return e.isVideo?s("video",{src:e.src,className:o?"active":null,id:e.src,crossOrigin:"anonymous",loop:!0,onLoadedMetadata:I=>{o&&(I.target.scrollIntoView({block:"center"}),I.target.play())}},t):s("img",{id:e.src,src:e.src,alt:"photo",className:o?"active":null,onLoad:I=>{o&&I.target.scrollIntoView({block:"center"})}},t)})}),s(k,{children:d&&E(D.div,{className:"photo-bottom-wrapper",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},children:[s("div",{className:"photo-carousel",ref:y,children:w.map((e,t)=>e.isVideo?s("video",{src:e.src,"data-carousel":t,controls:!1,muted:!0,onClick:o=>c(e)},t):s("img",{src:e.src,"data-carousel":t,onClick:o=>c(e)},t))}),E("div",{className:"photo-bottom",children:[s(U,{onClick:()=>{N.Share.set({type:"image",data:{src:i.src,isVideo:i.isVideo}})}}),s(_,{onClick:()=>{N.PopUp.set({title:m("APPS.PHOTOS.DELETE_IMAGE_TITLE"),description:m("APPS.PHOTOS.DELETE_IMAGE_TEXT"),buttons:[{title:m("APPS.PHOTOS.DELETE_IMAGE_BUTTON_CANCEL")},{title:m("APPS.PHOTOS.DELETE_IMAGE_BUTTON_DELETE"),color:"red",cb:()=>{f.handleDelete(f.image.src)}}]})}})]})]})})]})},R=({src:f,editMode:v})=>{const[S,r]=a.useState(null);return E(b,{children:[s("video",{src:f,crossOrigin:"anonymous",controls:!1,onMouseOver:d=>d.currentTarget.play(),onMouseOut:d=>d.currentTarget.pause(),muted:!0,onLoadedMetadata:d=>{r(d.currentTarget.duration)}}),S&&!v&&s("div",{className:"video-duration",children:(d=>{const T=Math.floor(d/60),u=z(d-T*60,0);return`${T}:${u<10?"0"+u:u}`})(S)})]})};export{J as default};
