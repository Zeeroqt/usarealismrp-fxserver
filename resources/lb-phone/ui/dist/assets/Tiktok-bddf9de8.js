import{a as s,j as e,r as i,F as z}from"./jsx-runtime-f40812bf.js";import{f as L,d as g,x as Ue,L as o,W as ue,aK as oe,C as W,bA as Fe,u as le,a2 as ce,bB as be,M as he,I as me,ag as We,_ as Ne,a3 as Te,Q as we,bz as ye,S as Ie,a1 as ke,X as Ke,k as ae,bC as De,v as ie,b as ve,c as re,bD as Ze,by as $e,bE as qe,ai as Ye,K as je,bw as Ve,bF as ze,bG as Re,bh as Je,bH as Xe,bI as Qe,bJ as et,bK as tt,bL as nt,bM as it,bN as st,bO as ot,ab as Me,g as Le,h as Ee,aF as xe,aj as lt,ak as at,V as rt,E as ct,ay as dt,bP as ut}from"./Phone-bbdfbfe1.js";import{S as mt}from"./Switch-51deb5c4.js";import{S as ft}from"./Slider-8373e24b.js";import"./number-28525126.js";function de(){return s("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e("circle",{cx:"24",cy:"24",r:"24",fill:"#20D5EC"}),e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M37.1213 15.8787C38.2929 17.0503 38.2929 18.9497 37.1213 20.1213L23.6213 33.6213C22.4497 34.7929 20.5503 34.7929 19.3787 33.6213L10.8787 25.1213C9.70711 23.9497 9.70711 22.0503 10.8787 20.8787C12.0503 19.7071 13.9497 19.7071 15.1213 20.8787L21.5 27.2574L32.8787 15.8787C34.0503 14.7071 35.9497 14.7071 37.1213 15.8787Z",fill:"white"})]})}function He(){return e("svg",{viewBox:"0 0 16 14",xmlns:"http://www.w3.org/2000/svg",children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.0203 0.108741C13.5601 -0.122158 15.75 1.87768 15.75 4.42804V4.49056C15.75 5.65597 15.2871 6.77366 14.463 7.59773L8.81009 13.2506C8.36271 13.698 7.63736 13.698 7.18998 13.2506L1.53704 7.59773C0.712962 6.77366 0.25 5.65597 0.25 4.49055V4.42806C0.25 1.87769 2.4399 -0.122157 4.97979 0.108742C6.17121 0.217053 7.26352 0.812457 8.00003 1.75171C8.73653 0.812457 9.82884 0.217052 11.0203 0.108741ZM14.25 4.42804C14.25 2.75973 12.8175 1.45154 11.1561 1.60258C10.3564 1.67528 9.625 2.08341 9.14323 2.72577L8.67378 3.3517C8.33691 3.80087 7.66317 3.80087 7.32629 3.35171L6.85681 2.72576C6.37504 2.08341 5.64364 1.67528 4.84399 1.60258C3.18252 1.45154 1.75 2.75974 1.75 4.42806V4.49055C1.75 5.25815 2.05493 5.9943 2.5977 6.53707L8.00003 11.9394L13.4023 6.53707C13.9451 5.9943 14.25 5.25815 14.25 4.49056V4.42804Z",fill:"currentColor"})})}function ht(){const{User:t}=i.useContext(B),[h]=t,[P,C]=i.useState(""),[v,u]=i.useState(""),[m,f]=i.useState([]),[d,r]=i.useState([]),[n,l]=i.useState(0),[a,U]=i.useState(!1),[y,_]=i.useState(0),[T,w]=i.useState(!1),[E,V]=i.useState(!1);i.useEffect(()=>{L("TikTok",{action:"getVideos",data:{full:!0,type:"recent"},page:0}).then(A=>{if(!A)return g("warning","Failed to get videos");r(A)})},[]),i.useEffect(()=>{P.length>0&&L("TikTok",{action:"searchAccounts",query:P}).then(A=>{if(!A)return g("info","No response, most likely no accounts to search for?");f(A)}),_(0),V(!1)},[P]),i.useEffect(()=>{const A=setTimeout(()=>C(v),500);return()=>clearTimeout(A)},[v]);const R=()=>{let A=P.length===0;if(A&&a)return g("info","Fetched everything, no need to fetch more (VIDEOS)");if(!A&&E)return g("info","Fetched everything, no need to fetch more (SEARCH)");if(T)return g("info","Already fetching");let c=document.querySelector("#last");if(!c)return g("warning","No last element");!ue(c)&&(w(!0),L("TikTok",{action:A?"getVideos":"searchAccounts",query:P,data:{full:!0,type:"recent"},page:(A?n:y)+1}).then(O=>{O&&O.length>0?(A?r(p=>[...p,...O]):f(p=>[...p,...O]),w(!1)):(w(!1),A?U(!0):V(!0))}),A?l(O=>O+1):_(O=>O+1))};return s("div",{className:"discover-container",children:[e("div",{className:"discover-header",children:e(Ue,{placeholder:o("APPS.TIKTOK.SEARCH_PLACEHOLDER"),onChange:A=>u(A.target.value)})}),P.length>0?e("div",{className:"search-results",onScroll:R,children:m==null?void 0:m.filter(A=>A.username!==h.username).map((A,c)=>e(vt,{data:A,last:m.length-1===c},c))}):e("div",{className:"discover-content",onScroll:R,children:d.map((A,c)=>e(Tt,{data:A,last:d.length-1===c},c))})]})}const vt=({data:t,last:h})=>{const{User:P,Func:C,GoBack:v}=i.useContext(B),[u,m]=v,[f,d]=i.useState(t.isFollowing),r=n=>{L("TikTok",{action:"toggleFollow",data:{username:t.username,follow:n}}).then(l=>{if(!l||!(l!=null&&l.success))return g("warning","Failed to toggle follow");if(l.error)return g("error",l.error);d(n)})};return s("div",{className:"item",id:h?"last":"",onClick:()=>{m({view:"discover"}),C.fetchAndSetProfile(t.username)},children:[s("div",{className:"item-user",children:[e("div",{className:"avatar",children:e("img",{src:q(t.avatar)})}),s("div",{className:"user",children:[s("div",{className:"name",children:[t.username,t.verified&&e(de,{})]}),e("div",{className:"username",children:t.name}),s("div",{className:"stats",children:[Y(t.followers)," ",o("APPS.TIKTOK.FOLLOWERS").toLowerCase()," ",Y(t.videos)??"0"," ",o("APPS.TIKTOK.VIDEOS").toLowerCase()]})]})]}),e("div",{className:"action",children:e("div",{className:oe("button",f?"following":"follow"),onClick:n=>{n.stopPropagation(),f?W.PopUp.set({title:o("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:o("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.name}),buttons:[{title:o("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:o("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>r(!1)}]}):r(!0)},children:f?o("APPS.TIKTOK.UNFOLLOW"):o("APPS.TIKTOK.FOLLOW")})})]})},Tt=({data:t,last:h})=>{const{Func:P,GoBack:C}=i.useContext(B),[v,u]=C;return s("div",{className:"item",id:h?"last":"",onClick:()=>{P.fetchAndSetVideo(t.id,{type:"recent"}),u({view:"discover"})},children:[s("div",{className:"video-item",children:[e("video",{src:t.src,loop:!0,onMouseEnter:m=>m.currentTarget.play(),onMouseLeave:m=>m.currentTarget.pause(),muted:!0}),e("div",{className:"timestamp",children:Ce(t.timestamp)})]}),s("div",{className:"video-items",children:[e("div",{className:"caption",children:t.caption}),s("div",{className:"video-info",children:[s("div",{className:"user",onClick:m=>{m.stopPropagation(),u({view:"discover"}),P.fetchAndSetProfile(t.username)},children:[e("img",{src:q(t.avatar)}),e("div",{className:"name",children:t.username})]}),s("div",{className:"stats",children:[s("div",{children:[e(Fe,{className:"plays"}),Y(t.views)]}),s("div",{children:[e(He,{}),Y(t.likes)]})]})]})]})]})};function gt(){const{User:t,View:h,Dm:P}=i.useContext(B),[C,v]=h,[u,m]=P,[f,d]=i.useState(!1),[r,n]=i.useState([]);return i.useEffect(()=>{L("TikTok",{action:"getRecentMessages"}).then(l=>{if(!(l!=null&&l.success))return g("warning",l.error);n(l.channels)})},[]),le("tiktok:receivedMessage",l=>{n(a=>{let U=a.findIndex(_=>_.channelId===l.channelId);if(U===-1)return a;let y=[...a];return y[U].lastMessage=l.content,y[U].lastMessageTimestamp=Date.now(),y})}),s(ce.div,{...be,className:"messages-container",children:[e(he,{children:f&&e(Pt,{close:()=>d(!1)})}),s("div",{className:"messages-header",children:[e(me,{onClick:()=>v("inbox")}),e("div",{className:"title",children:o("APPS.TIKTOK.DIRECT_MESSAGES")}),e(We,{onClick:()=>d(!0)})]}),s("div",{className:"messages-body",children:[r.length===0&&s("div",{className:"no-messages",children:[e("svg",{width:"72",height:"61",viewBox:"0 0 72 61",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M1.397 2.51652C0.511234 1.55537 1.19298 0 2.50003 0H69.5C70.6548 0 71.3765 1.25023 70.7989 2.25023L37.2989 60.2502C36.6438 61.3845 34.9516 61.1931 34.5664 59.9411L24.6664 27.7663L1.397 2.51652ZM27.7868 27.7066L36.4219 55.7705L66.9014 3H5.92221L26.2933 25.1048L46.2558 13.6976C46.9751 13.2866 47.8914 13.5365 48.3024 14.2558C48.7134 14.9751 48.4635 15.8913 47.7442 16.3024L27.7868 27.7066Z",fill:"#AFB0B3"})}),e("div",{className:"title",children:o("APPS.TIKTOK.NO_MESSAGES_TITLE")}),e("div",{className:"content",children:o("APPS.TIKTOK.NO_MESSAGES_SUBTITLE")})]}),r.map((l,a)=>s("div",{className:"message","data-unread":l.unread_messages>0,onClick:()=>{m({id:l.id,name:l.name,username:l.username,avatar:l.avatar,verified:l.verified,follower_count:l.follower_count,following_count:l.following_count,video_count:l.video_count}),l.unread_messages>0&&L("TikTok",{action:"clearUnreadMessages",id:l.id}),v("dm")},children:[s("div",{className:"user",children:[e("img",{src:q(l.avatar)}),s("div",{className:"message-content",children:[e("div",{className:"username",children:l.name}),e("div",{className:"content",children:l.last_message})]})]}),e("div",{className:"timestamp",children:Ne(l.timestamp)})]},a))]})]})}const Pt=({close:t})=>{const{User:h}=i.useContext(B),[P]=h,[C,v]=i.useState(""),[u,m]=i.useState(""),[f,d]=i.useState([]);i.useEffect(()=>{const n=setTimeout(()=>v(u),500);return()=>clearTimeout(n)},[u]),i.useEffect(()=>{C.length>0&&L("TikTok",{action:"searchAccounts",query:C}).then(n=>{if(!n)return g("info","No response, most likely no accounts to search for?");d(n)})},[C]);const r=n=>{};return s(ce.div,{...Te,className:"search-container",children:[s("div",{className:"search-header",children:[e(we,{onClick:t}),e(Ue,{placeholder:o("APPS.TIKTOK.SEARCH_PLACEHOLDER"),onChange:n=>m(n.target.value)}),e("span",{})]}),e("div",{className:"search-results",onScroll:r,children:f==null?void 0:f.filter(n=>n.username!==P.username).map((n,l)=>e(Ct,{data:n,last:f.length-1===l},l))})]})},Ct=({data:t,last:h})=>{const{User:P,View:C,Dm:v}=i.useContext(B),[u,m]=C,[f,d]=v;return e("div",{className:"item",id:h?"last":"",onClick:()=>{d({name:t.name,username:t.username,avatar:t.avatar,verified:t.verified,follower_count:t.follower_count,following_count:t.following_count,video_count:t.video_count}),m("dm")},children:s("div",{className:"item-user",children:[e("div",{className:"avatar",children:e("img",{src:q(t.avatar)})}),s("div",{className:"user",children:[s("div",{className:"name",children:[t.username,t.verified&&e(de,{})]}),e("div",{className:"username",children:t.name}),s("div",{className:"stats",children:[Y(t.follower_count)," ",o("APPS.TIKTOK.FOLLOWERS").toLowerCase()," ",Y(t.video_count)??"0"," ",o("APPS.TIKTOK.VIDEOS").toLowerCase()]})]})]})})};function Be({className:t}){return s("svg",{className:t,width:"43",height:"43",viewBox:"0 0 43 43",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[s("g",{filter:"url(#filter0_d_4_1160)",children:[e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M21.8242 33.4976C21.7164 33.4992 21.6083 33.5 21.5 33.5C11.835 33.5 4 27.0081 4 19C4 10.9919 11.835 4.5 21.5 4.5C31.165 4.5 39 10.9919 39 19C39 21.0253 38.4989 22.9536 37.5938 24.7044C36.3794 27.1797 34.5051 29.3888 32.472 31.2945C29.3743 34.1981 25.7901 36.39 23.2378 37.6253C22.5627 37.9521 21.8242 37.4404 21.8242 36.7278V33.4976ZM15.5 19.75C15.5 21.1307 14.3807 22.25 13 22.25C11.6193 22.25 10.5 21.1307 10.5 19.75C10.5 18.3693 11.6193 17.25 13 17.25C14.3807 17.25 15.5 18.3693 15.5 19.75ZM21.5 22.25C22.8807 22.25 24 21.1307 24 19.75C24 18.3693 22.8807 17.25 21.5 17.25C20.1193 17.25 19 18.3693 19 19.75C19 21.1307 20.1193 22.25 21.5 22.25ZM32.5 19.75C32.5 21.1307 31.3807 22.25 30 22.25C28.6193 22.25 27.5 21.1307 27.5 19.75C27.5 18.3693 28.6193 17.25 30 17.25C31.3807 17.25 32.5 18.3693 32.5 19.75Z",fill:"currentColor"}),e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M21.5 33.5C31.165 33.5 39 27.0081 39 19C39 10.9919 31.165 4.5 21.5 4.5C11.835 4.5 4 10.9919 4 19C4 27.0081 11.835 33.5 21.5 33.5ZM13 22.25C14.3807 22.25 15.5 21.1307 15.5 19.75C15.5 18.3693 14.3807 17.25 13 17.25C11.6193 17.25 10.5 18.3693 10.5 19.75C10.5 21.1307 11.6193 22.25 13 22.25ZM24 19.75C24 21.1307 22.8807 22.25 21.5 22.25C20.1193 22.25 19 21.1307 19 19.75C19 18.3693 20.1193 17.25 21.5 17.25C22.8807 17.25 24 18.3693 24 19.75ZM30 22.25C31.3807 22.25 32.5 21.1307 32.5 19.75C32.5 18.3693 31.3807 17.25 30 17.25C28.6193 17.25 27.5 18.3693 27.5 19.75C27.5 21.1307 28.6193 22.25 30 22.25Z",fill:"currentColor"})]}),e("defs",{children:s("filter",{id:"filter0_d_4_1160",x:"0",y:"0.83",width:"43",height:"41.2262",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[e("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),e("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),e("feOffset",{dy:"0.33"}),e("feGaussianBlur",{stdDeviation:"2"}),e("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),e("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_4_1160"}),e("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_4_1160",result:"shape"})]})})]})}function Oe({className:t}){return s("svg",{className:t,viewBox:"0 0 44 41",xmlns:"http://www.w3.org/2000/svg",children:[s("g",{filter:"url(#filter0_d_4_1165)",children:[e("path",{d:"M20.0611 35.818C21.0718 36.5395 22.4282 36.5395 23.4389 35.818C28.4905 32.2118 33.3281 28.063 36.6744 22.7538C38.3509 20.0939 39.0537 17.9429 39.3301 16.184C39.4416 15.5647 39.5 14.9257 39.5 14.2725C39.5 8.59918 35.097 4 29.6655 4C26.4197 4 23.5411 5.64254 21.75 8.17528C19.9589 5.64254 17.0803 4 13.8345 4C8.40304 4 4 8.59918 4 14.2725C4 14.9257 4.05836 15.5647 4.16994 16.184C4.44634 17.9429 5.14906 20.0939 6.82555 22.7538C10.1719 28.063 15.0095 32.2118 20.0611 35.818Z",fill:"currentColor"}),e("path",{d:"M20.0611 31.5C21.0718 32.2216 22.4282 32.2216 23.4389 31.5C29 28.5 31 27.5 36.6744 22.7538C38.3509 20.0939 39.0537 17.9429 39.3301 16.184C39.4416 15.5647 39.5 14.9257 39.5 14.2725C39.5 8.59918 35.097 4 29.6655 4C26.4197 4 23.5411 5.64254 21.75 8.17528C19.9589 5.64254 17.0803 4 13.8345 4C8.40304 4 4 8.59918 4 14.2725C4 14.9257 4.05836 15.5647 4.16994 16.184C4.44634 17.9429 5.14906 20.0939 6.82555 22.7538C13 27.5 15 28.5 20.0611 31.5Z",fill:"currentColor"})]}),e("defs",{children:s("filter",{id:"filter0_d_4_1165",x:"0",y:"0.33",width:"43.5",height:"40.3591",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[e("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),e("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),e("feOffset",{dy:"0.33"}),e("feGaussianBlur",{stdDeviation:"2"}),e("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),e("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_4_1165"}),e("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_4_1165",result:"shape"})]})})]})}function pt(){const{User:t,Profile:h,View:P}=i.useContext(B),[C,v]=P,[u,m]=i.useState([]),[f,d]=i.useState(0),[r,n]=i.useState(0),[l,a]=i.useState(!1),[U,y]=i.useState(!1);i.useEffect(()=>{L("TikTok",{action:"getUnreadMessages"}).then(T=>{if(!T.success)return g("warning","Failed to get unread messages: "+T.error);d(T==null?void 0:T.unread)}),L("TikTok",{action:"getNotifications",page:0}).then(T=>{if(!T.success)return g("warning","Failed to get notifications: "+T.error);m(T.data)})},[]);const _=()=>{if(U||l)return;let T=document.querySelector("#last");if(!T)return;!ue(T)&&(a(!0),L("TikTok",{action:"getNotifications",page:r+1}).then(E=>{var V;if(!(E!=null&&E.success))return g("warning","Failed to get notifications: "+E.error);if(!(E!=null&&E.data))return g("warning","Failed to get notifications: (NO DATA)"+(E==null?void 0:E.error));E&&((V=E==null?void 0:E.data)==null?void 0:V.length)>0?(m([...u,...E.data]),a(!1)):y(!0)}),n(E=>E+1))};return s("div",{className:"inbox-container",children:[s("div",{className:"inbox-header",children:[e("span",{}),e("div",{className:"title",children:o("APPS.TIKTOK.ALL_ACTIVITY")}),s("div",{className:"messages",onClick:()=>v("messages"),children:[e(ye,{}),f>0&&e("div",{className:"notifications",children:f})]})]}),s("div",{className:"inbox-body",onScroll:_,children:[u.length===0&&s("div",{className:"no-notifications",children:[e("svg",{width:"1em",height:"1em",viewBox:"0 0 32 32",xmlns:"http://www.w3.org/2000/svg",children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M24.0362 21.3333H18.5243L15.9983 24.4208L13.4721 21.3333H7.96047L7.99557 8H24.0009L24.0362 21.3333ZM24.3705 23.3333H19.4721L17.2883 26.0026C16.6215 26.8176 15.3753 26.8176 14.7084 26.0026L12.5243 23.3333H7.62626C6.70407 23.3333 5.95717 22.5845 5.9596 21.6623L5.99646 7.66228C5.99887 6.74352 6.74435 6 7.66312 6H24.3333C25.2521 6 25.9975 6.7435 26 7.66224L26.0371 21.6622C26.0396 22.5844 25.2927 23.3333 24.3705 23.3333ZM12.6647 14C12.2965 14 11.998 14.2985 11.998 14.6667V15.3333C11.998 15.7015 12.2965 16 12.6647 16H19.3313C19.6995 16 19.998 15.7015 19.998 15.3333V14.6667C19.998 14.2985 19.6995 14 19.3313 14H12.6647Z"})}),e("div",{className:"title",children:o("APPS.TIKTOK.NO_NOTIFICATIONS")}),e("div",{className:"content",children:o("APPS.TIKTOK.NO_NOTIFICATIONS_SUBTITLE")})]}),u.map((T,w)=>e(St,{data:T,last:u.length-1===w},w))]})]})}const St=({data:t,last:h})=>{const{Func:P,GoBack:C}=i.useContext(B),[v,u]=C,[m,f]=i.useState(t.isFollowing),d=l=>{L("TikTok",{action:"toggleFollow",data:{username:t.username,follow:l}}).then(a=>{if(!a||!(a!=null&&a.success))return g("warning","Failed to toggle follow");if(a.error)return g("error",a.error);f(l)})};let r;switch(t.type){case"follow":r=o("APPS.TIKTOK.STARTED_FOLLOWING");break;case"like":r=o("APPS.TIKTOK.LIKED_VIDEO");break;case"like_comment":r=o("APPS.TIKTOK.LIKED_COMMENT");break;case"save":r=o("APPS.TIKTOK.SAVED_VIDEO");break;case"comment":r=o("APPS.TIKTOK.COMMENTED").format({comment:t.commentText});break;case"reply":r=o("APPS.TIKTOK.REPLIED").format({comment:t.commentText});break}const n=()=>{u({view:"inbox"}),P.fetchAndSetProfile(t.username)};return s("div",{className:oe("notification",t.type),id:h?"last":"",children:[s("div",{className:"user",children:[s("div",{className:"avatar",onClick:n,children:[e("img",{src:q(t.avatar)}),(t.type==="like"||t.type==="comment"||t.type==="reply")&&e("div",{className:"type","data-color":t.type==="like"?"red":"blue",children:t.type==="like"?e(Oe,{}):e(Be,{})})]}),s("div",{className:"info",children:[s("div",{className:"username",onClick:n,children:[t.name,t.verified&&e(de,{})]}),s("div",{className:"notification-content",children:[r,e("div",{className:"timestamp",children:Ce(t.timestamp)})]}),(t.type==="reply"||t.type==="like_comment")&&s("div",{className:"original-text",children:[e("div",{className:"border"}),t.type==="like_comment"?t.commentText:t.originalText]})]})]}),t.type==="follow"?e("div",{className:oe("button",m?"following":"follow"),onClick:l=>{l.stopPropagation(),m?W.PopUp.set({title:o("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:o("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.name}),buttons:[{title:o("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:o("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>d(!1)}]}):d(!0)},children:m?o("APPS.TIKTOK.UNFOLLOW"):o("APPS.TIKTOK.FOLLOW")}):e("div",{className:"video-preview",onClick:()=>{t.videoId&&(u({view:"inbox"}),P.fetchAndSetVideo(t.videoId,{single:!0}))},children:e("video",{src:t.videoSrc,controls:!1,autoPlay:!1,muted:!0})})]})};function Nt(){const{User:t,GoBack:h,View:P,Func:C,Dm:v,Profile:u}=i.useContext(B),[m,f]=t,[d,r]=P,[n]=v,[l,a]=h,[U,y]=u,[_,T]=i.useState([]),[w,E]=i.useState(n==null?void 0:n.id),V=i.useRef(null),[R,A]=i.useState(""),[c,k]=i.useState(0),[O,p]=i.useState(!1),[N,F]=i.useState(!1);i.useEffect(()=>(Ie.ReceiveAppNotifications.set(!1),()=>{Ie.ReceiveAppNotifications.set(!0)}),[]),i.useEffect(()=>{w&&L("TikTok",{action:"getMessages",page:0,id:w}).then(S=>{if(!(S!=null&&S.success))return g("warning","An error occured while fetching messages. "+(S==null?void 0:S.error));if(!(S!=null&&S.messages))return g("warning","An error occured while fetching messages. (No messages)");T(S.messages.reverse())})},[w]),le("tiktok:receivedMessage",S=>{n.username===S.sender&&T([..._,{...S,timestamp:new Date().getTime()}])});const x=()=>{if(R.trim().length===0)return g("warning","You can't send an empty message");L("TikTok",{action:"sendMessage",data:{id:w,username:n.username,content:R}}).then(S=>{if(!(S!=null&&S.success))return g("warning","An error occured while sending message. "+(S==null?void 0:S.error));g("info",`Message sent to ${n.username}, id: ${S.id}, channelId: ${S==null?void 0:S.channelId}`),S!=null&&S.channelId&&!w&&E(S.channelId),V.current.value="",T([..._,{id:S.id,sender:m.username,recipient:n.username,content:R,timestamp:new Date().getTime()}]),A("");let $=document.querySelector(".dm-body");$.scrollTop=$.scrollHeight})},M=()=>{if(O||N)return;let S=document.querySelector("#last");if(!S)return;!ue(S)&&(F(!0),L("Instagram",{action:"getMessages",page:c+1,username:n.username}).then(Z=>{Z&&Z.length>0?(T([...Z.reverse(),..._]),F(!1)):p(!0)}),k(Z=>Z+1))},j=S=>{if(S)return/<!SHARED-VIDEO-URL="(.*)"ID="(.*)"!>/.test(S)},te=S=>{C.fetchAndSetVideo(S,{single:!0}),a({view:"dm"})};return s(ce.div,{...be,className:"dm-container",children:[s("div",{className:"dm-header",children:[e(me,{onClick:()=>{l!=null&&l.view?(l.data&&l.data.identifier==="profile"&&y(l.data.data),r(l.view),a(null)):r("messages")},className:"chevron"}),s("div",{className:"profile",onClick:S=>{S.stopPropagation(),a({view:"dm",data:{identifier:"dm",data:n}}),C.fetchAndSetProfile(n.username)},children:[e("div",{className:"avatar",children:e("img",{src:q(n.avatar)})}),s("div",{className:"username",children:[n.name??n.username,n.verified&&e(de,{})]})]})]}),e("div",{className:"dm-body-container",onScroll:M,children:s("div",{className:"dm-body",children:[s("div",{className:"messages-hero","data-nomessages":_.length===0,children:[e("img",{className:"avatar",src:q(n.avatar)}),e("div",{className:"name",children:n.name}),s("div",{className:"secondary",children:[s("div",{className:"username",children:["@",n.username]}),s("div",{className:"stats",children:[s("div",{className:"following",children:[Y(n.following_count)," ",o("APPS.TIKTOK.FOLLOWING").toLowerCase()]}),s("div",{className:"followers",children:[Y(n.follower_count)," ",o("APPS.TIKTOK.FOLLOWERS").toLowerCase()]})]})]})]}),_.map((S,$)=>{var G;let Z,ne=$===0,J=S.sender===m.username?"self":"other",b=((G=_[$+1])==null?void 0:G.sender)===m.username?"self":"other";return _[$+1]?Z=Math.abs(S.timestamp-_[$+1].timestamp)/36e5:b=void 0,S.content&&j(S.content)&&(S.video=S.content.match(/<!SHARED-VIDEO-URL="(.*)"ID="(.*)"!>/)[1],S.videoId=S.content.match(/<!SHARED-VIDEO-URL="(.*)"ID="(.*)"!>/)[2]),s("div",{className:`message ${J}`,id:ne?"last":"",children:[J=="other"?s("div",{className:"message-with-pfp",children:[e("div",{className:`profile-picture ${J!==b?"show":"hide"}`,onClick:X=>{X.stopPropagation(),a({view:"dm",data:{identifier:"dm",data:n}}),C.fetchAndSetProfile(n.username)},children:e("img",{src:q(n.avatar)})}),e("div",{className:"message-content",children:S.video?s("div",{className:"shared-video",onClick:()=>te(S.videoId),children:[e("video",{src:S.video,autoPlay:!1,controls:!1}),e(ke,{})]}):e("div",{className:"content",children:Ke(S.content)})})]}):e(z,{children:S.video?s("div",{className:"shared-video",onClick:()=>te(S.videoId),children:[e("video",{src:S.video,autoPlay:!1,controls:!1}),e(ke,{})]}):e("div",{className:"content",children:Ke(S.content)})}),_[$+1]&&Z>6?e("div",{className:"date",children:Ne(S.timestamp)}):J!==b&&e("div",{className:"date",children:Ne(S.timestamp)})]},$)})]})}),s("div",{className:"dm-footer",children:[e(ae,{type:"text",ref:V,onChange:S=>A(S.target.value),onKeyDown:S=>{S.key==="Enter"&&x()},placeholder:o("APPS.INSTAGRAM.MESSAGE_PLACEHOLDER")}),e(De,{"data-disabled":R.trim().length===0,onClick:x})]})]})}function It(){const{User:t,LoggedIn:h,View:P}=i.useContext(B),[C,v]=t,[u,m]=h,[f,d]=P,[r,n]=i.useState("login"),[l,a]=i.useState(null),[U,y]=i.useState(!0),_=()=>{let T=l==null?void 0:l.username.toLowerCase().replace(/\s/g,"");if(U)return g("warning","Button is disabled");if(!l)return g("warning","No form data");L("TikTok",{action:r,data:l}).then(w=>{var E,V,R,A,c;if(!w)return g("warning","Could not login, no response");if(w.success){let k={...w.data,username:((E=w.data)==null?void 0:E.username)??T,name:((V=w.data)==null?void 0:V.username)??(l==null?void 0:l.name),follower_count:((R=w.data)==null?void 0:R.follower_count)||0,following_count:((A=w.data)==null?void 0:A.following_count)||0,like_count:((c=w.data)==null?void 0:c.like_count)||0};v(k),m(!0),d("feed"),ie.APPS.TIKTOK.account.set(k)}else g("info",`Could not login, ${w.error}`)})};return i.useEffect(()=>{var T,w;l&&y(r==="login"?!l.username||!l.password:!l.name||!l.username&&((T=l.username)==null?void 0:T.length)<3||!l.password&&((w=l.password)==null?void 0:w.length)<3)},[l]),s("div",{className:"login-container",children:[s("div",{className:"login-header",children:[e("div",{className:"title",children:r==="login"?o("APPS.TIKTOK.LOGIN_TITLE"):o("APPS.TIKTOK.SIGNUP_TITLE")}),e("div",{className:"subtitle",children:r==="login"?o("APPS.TIKTOK.LOGIN_SUBTITLE"):o("APPS.TIKTOK.SIGNUP_SUBTITLE")})]}),s("div",{className:"login-body",children:[r==="signup"&&e(ae,{placeholder:o("APPS.TIKTOK.NAME"),onChange:T=>{T.target.value.length>30||a({...l,name:T.target.value})}}),e(ae,{placeholder:o("APPS.TIKTOK.USERNAME"),onChange:T=>{T.target.value.length>20||a({...l,username:T.target.value.toLowerCase()})}}),e(ae,{type:"password",placeholder:o("APPS.TIKTOK.PASSWORD"),onChange:T=>{T.target.value.length>50||a({...l,password:T.target.value})}}),e("div",{className:"login-button","data-disabled":U,onClick:_,children:r==="login"?o("APPS.TIKTOK.LOGIN"):o("APPS.TIKTOK.SIGNUP")})]}),e("div",{className:"login-footer",children:r==="login"?s(z,{children:[o("APPS.TIKTOK.NO_ACCOUNT")," ",e("span",{onClick:()=>n("signup"),children:o("APPS.TIKTOK.SIGNUP")})]}):s(z,{children:[o("APPS.TIKTOK.ALREADY_ACCOUNT")," ",e("span",{onClick:()=>n("login"),children:o("APPS.TIKTOK.LOGIN")})]})})]})}function wt(){const{View:t,User:h,Profile:P,FeedData:C}=i.useContext(B),v=ve(re.Settings),[u,m]=h,[f,d]=t,[r,n]=P,[l,a]=C;return s("div",{className:"tiktok-footer","data-feed":f==="feed",children:[e(Pe,{icon:e("svg",{width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M23.0484 7.84003C23.6014 7.38666 24.3975 7.38666 24.9504 7.84001L41.051 21.04C41.5411 21.4418 41.7258 22.1082 41.5125 22.705C41.2991 23.3017 40.7338 23.7 40.1 23.7H37.769L36.5769 36.7278C36.4592 38.0149 35.3798 39 34.0873 39H13.9127C12.6202 39 11.5409 38.0149 11.4231 36.7278L10.231 23.7H7.89943C7.2657 23.7 6.70035 23.3017 6.487 22.705C6.27364 22.1083 6.45833 21.4418 6.9484 21.04L23.0484 7.84003ZM23.9995 10.9397L12.0948 20.7H12.969L14.369 36H22.4994V28.3138C22.4994 27.7616 22.9471 27.3138 23.4994 27.3138H24.4994C25.0517 27.3138 25.4994 27.7616 25.4994 28.3138V36H33.631L35.031 20.7H35.9045L23.9995 10.9397Z"})}),value:"feed",label:o("APPS.TIKTOK.HOME"),cb:()=>{d("feed"),a(null)}}),e(Pe,{icon:e("svg",{width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M21.7764 10.5C16.1265 10.5 11.5 15.172 11.5 20.993C11.5 26.814 16.1265 31.486 21.7764 31.486C24.5005 31.486 26.9782 30.4054 28.8221 28.6314C30.8097 26.7191 32.0527 24.0079 32.0527 20.993C32.0527 15.172 27.4262 10.5 21.7764 10.5ZM8.5 20.993C8.5 13.5669 14.4184 7.5 21.7764 7.5C29.1344 7.5 35.0527 13.5669 35.0527 20.993C35.0527 24.2993 33.881 27.3328 31.9342 29.6817L38.3696 36.2355C38.7566 36.6296 38.7508 37.2627 38.3568 37.6497L37.6432 38.3503C37.2492 38.7373 36.616 38.7315 36.2291 38.3374L29.7742 31.7638C27.5523 33.4701 24.7814 34.486 21.7764 34.486C14.4184 34.486 8.5 28.4191 8.5 20.993Z"})}),value:"discover",label:o("APPS.TIKTOK.DISCOVER")}),e("div",{className:"item",onClick:()=>d("upload"),children:e("img",{src:`./assets/img/icons/tiktok/add${v.display.theme==="light"&&f==="feed"?"":"-dark"}.svg`})}),e(Pe,{icon:e("svg",{width:"1em",height:"1em",viewBox:"0 0 32 32",xmlns:"http://www.w3.org/2000/svg",children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M24.0362 21.3333H18.5243L15.9983 24.4208L13.4721 21.3333H7.96047L7.99557 8H24.0009L24.0362 21.3333ZM24.3705 23.3333H19.4721L17.2883 26.0026C16.6215 26.8176 15.3753 26.8176 14.7084 26.0026L12.5243 23.3333H7.62626C6.70407 23.3333 5.95717 22.5845 5.9596 21.6623L5.99646 7.66228C5.99887 6.74352 6.74435 6 7.66312 6H24.3333C25.2521 6 25.9975 6.7435 26 7.66224L26.0371 21.6622C26.0396 22.5844 25.2927 23.3333 24.3705 23.3333ZM12.6647 14C12.2965 14 11.998 14.2985 11.998 14.6667V15.3333C11.998 15.7015 12.2965 16 12.6647 16H19.3313C19.6995 16 19.998 15.7015 19.998 15.3333V14.6667C19.998 14.2985 19.6995 14 19.3313 14H12.6647Z"})}),value:"inbox",label:o("APPS.TIKTOK.INBOX")}),e(Pe,{icon:e("svg",{width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M24.0001 11.5C20.9625 11.5 18.5001 13.9624 18.5001 17C18.5001 20.0376 20.9625 22.5 24.0001 22.5C27.0377 22.5 29.5001 20.0376 29.5001 17C29.5001 13.9624 27.0377 11.5 24.0001 11.5ZM15.5001 17C15.5001 12.3056 19.3057 8.5 24.0001 8.5C28.6945 8.5 32.5001 12.3056 32.5001 17C32.5001 21.6944 28.6945 25.5 24.0001 25.5C19.3057 25.5 15.5001 21.6944 15.5001 17ZM24.0001 30.5C19.1458 30.5 15.0586 33.7954 13.8578 38.2712C13.7147 38.8046 13.2038 39.1741 12.6591 39.0827L11.6729 38.9173C11.1282 38.8259 10.7571 38.3085 10.8888 37.7722C12.3362 31.8748 17.6559 27.5 24.0001 27.5C30.3443 27.5 35.664 31.8748 37.1114 37.7722C37.2431 38.3085 36.872 38.8259 36.3273 38.9173L35.3411 39.0827C34.7964 39.1741 34.2855 38.8046 34.1424 38.2712C32.9416 33.7954 28.8544 30.5 24.0001 30.5Z"})}),value:"profile",cb:()=>{n(u),d("profile")},label:o("APPS.TIKTOK.PROFILE")})]})}const Pe=({icon:t,value:h,cb:P,label:C})=>{const{View:v}=i.useContext(B),[u,m]=v;return e("div",{className:"item","data-active":u===h,onClick:()=>P?P():m(h),children:s(z,{children:[t,C]})})};function Ot(){const{User:t,ShareComponent:h,View:P}=i.useContext(B),[C]=t,[v,u]=P,[m,f]=h,[d,r]=i.useState([]);i.useState(!1);const[n,l]=i.useState(m==null?void 0:m.pinned);return i.useEffect(()=>{L("TikTok",{action:"getRecentMessages"}).then(a=>{if(!(a!=null&&a.success))return g("warning",a.error);r(a.channels.sort((U,y)=>y.timestamp-U.timestamp))})},[]),e("div",{className:"share-container",onClick:()=>f(null),children:s(ce.div,{...Te,className:"share-wrapper",onClick:a=>a.stopPropagation(),children:[e("div",{className:"share-header",children:o("APPS.TIKTOK.SHARE_TITLE")}),s("div",{className:"share-body",children:[e("div",{className:"friends",children:d.map(a=>e(At,{data:{username:a.username,name:a.name,avatar:a.avatar,verified:a.verified}}))}),s("div",{className:"options",children:[s("div",{className:"item",children:[e(Ze,{}),o("APPS.TIKTOK.REPORT")]}),C.username===(m==null?void 0:m.username)&&s(z,{children:[s("div",{className:"item",onClick:()=>{W.PopUp.set({title:o("APPS.TIKTOK.PIN_VIDEO_POPUP.TITLE"),description:o("APPS.TIKTOK.PIN_VIDEO_POPUP.DESCRIPTION").format({action:n?o("APPS.TIKTOK.UNPIN"):o("APPS.TIKTOK.PIN")}),buttons:[{title:o("APPS.TIKTOK.PIN_VIDEO_POPUP.CANCEL")},{title:o("APPS.TIKTOK.PIN_VIDEO_POPUP.PROCEED"),color:n?"red":null,cb:()=>{L("TikTok",{action:"togglePinnedVideo",id:m==null?void 0:m.id,toggle:!n}).then(a=>{if(a!=null&&a.success||g("warning",a.error),a!=null&&a.error&&a.error==="max_pinned")return W.PopUp.set({title:o("APPS.TIKTOK.MAX_PINNED_TITLE"),description:o("APPS.TIKTOK.MAX_PINNED_DESCRIPTION"),buttons:[{title:o("APPS.TIKTOK.OK")}]});l(!n)})}}]})},children:[e($e,{}),n?o("APPS.TIKTOK.UNPIN_VIDEO"):o("APPS.TIKTOK.PIN_VIDEO")]}),s("div",{className:"item",onClick:()=>{W.PopUp.set({title:o("APPS.TIKTOK.DELETE_VIDEO_POPUP.TITLE"),description:o("APPS.TIKTOK.DELETE_VIDEO_POPUP.DESCRIPTION"),buttons:[{title:o("APPS.TIKTOK.DELETE_VIDEO_POPUP.CANCEL")},{title:o("APPS.TIKTOK.DELETE_VIDEO_POPUP.PROCEED"),color:"red",cb:()=>{L("TikTok",{action:"deleteVideo",id:m==null?void 0:m.id}).then(a=>{a!=null&&a.success||g("warning",a.error),f(null),u("profile")})}}]})},children:[e(qe,{}),o("APPS.TIKTOK.DELETE")]})]})]})]}),e("div",{className:"share-footer",onClick:()=>f(null),children:o("APPS.TIKTOK.CANCEL")})]})})}const At=t=>{const{ShareComponent:h}=i.useContext(B),[P]=h,[C,v]=i.useState(!1);return s("div",{className:"item","data-sent":C,onClick:()=>{if(C)return g("warning","You have already sent this video to this user!");L("TikTok",{action:"sendMessage",data:{username:t.data.username,content:`<!SHARED-VIDEO-URL="${P.src}"ID="${P.id}"!>`}}).then(m=>{if(!(m!=null&&m.success))return g("warning",m.error);g("info","Successfully sent video to user!"),v(!0)})},children:[e("img",{src:q(t.data.avatar)}),e("div",{className:"name",children:t.data.name}),C&&e(Ye,{className:"checkmark"})]})};function kt(){const{UserPanel:t}=i.useContext(B),[h,P]=t,[C,v]=i.useState([]),[u,m]=i.useState(h==null?void 0:h.value),[f,d]=i.useState(0),[r,n]=i.useState(!1),[l,a]=i.useState(!1),U={following:"getFollowing",followers:"getFollowers"},y={following:o("APPS.TIKTOK.FOLLOWING"),followers:o("APPS.TIKTOK.FOLLOWERS")};i.useEffect(()=>{!h||!(h!=null&&h.value)||u&&L("TikTok",{action:U[u],username:h.username,page:0}).then(T=>{T&&v(T)})},[u]);const _=()=>{if(r||l)return;!ue(document.querySelector("#last"))&&(a(!0),L("TikTok",{action:U[h.value],username:h.username,page:f+1}).then(w=>{w&&w.length>0?(v([...C,...w]),a(!1)):n(!0)}),d(w=>w+1))};return s(ce.div,{...Te,className:"userpanel-container",children:[s("div",{className:"userpanel-header",children:[e("div",{onClick:()=>P(null),children:e(me,{})}),e("div",{className:"title",children:h==null?void 0:h.username}),e("div",{})]}),e("div",{className:"userpanel-selector",children:["following","followers"].map(T=>s("div",{className:"item","data-active":u===T,onClick:()=>m(T),children:[y[T]," ",Y(h==null?void 0:h[T])??0]}))}),e("div",{className:"userpanel-content",onScroll:_,children:C.map((T,w)=>e(Kt,{data:T,last:w===C.length-1}))})]})}const Kt=({data:t,last:h})=>{const{Func:P,UserPanel:C}=i.useContext(B),[v,u]=C,[m,f]=i.useState(t.isFollowing),d=r=>{L("TikTok",{action:"toggleFollow",data:{username:t.username,follow:r}}).then(n=>{if(!n||!(n!=null&&n.success))return g("warning","Failed to toggle follow");if(n.error)return g("error",n.error);f(r)})};return s("div",{className:"item",id:h?"last":"",onClick:()=>{P.fetchAndSetProfile(t.username),u(null)},children:[s("div",{className:"item-user",children:[e("div",{className:"avatar",children:e("img",{src:q(t.avatar)})}),s("div",{className:"user",children:[s("div",{className:"name",children:[t.name," ",t.verified&&e(de,{})]}),e("div",{className:"username",children:t.username})]})]}),e("div",{className:"action",children:e("div",{className:oe("button",m?"following":"follow"),onClick:r=>{r.stopPropagation(),m?W.PopUp.set({title:o("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:o("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.name}),buttons:[{title:o("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:o("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>d(!1)}]}):d(!0)},children:m?o("APPS.TIKTOK.UNFOLLOW"):o("APPS.TIKTOK.FOLLOW")})})]})};function Lt(){return s("svg",{viewBox:"0 0 23 23",xmlns:"http://www.w3.org/2000/svg",children:[e("path",{d:"M7.56201 11C8.39038 11 9.06201 10.1045 9.06201 9C9.06201 7.89551 8.39038 7 7.56201 7C6.73364 7 6.06201 7.89551 6.06201 9C6.06201 10.1045 6.73364 11 7.56201 11Z",fill:"currentColor"}),e("path",{d:"M16.062 9C16.062 10.1045 15.3904 11 14.562 11C13.7336 11 13.062 10.1045 13.062 9C13.062 7.89551 13.7336 7 14.562 7C15.3904 7 16.062 7.89551 16.062 9Z",fill:"currentColor"}),e("path",{d:"M11.062 15.7891C12.562 15.7891 14.062 14.7373 14.062 13.6328C14.062 12.5283 12.062 12.5 11.062 12.5C10.062 12.5 8.06201 12.5283 8.06201 13.6328C8.06201 14.7373 9.56201 15.7891 11.062 15.7891Z",fill:"currentColor"}),e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M22.062 11.5C22.062 17.5752 17.1372 22.5 11.062 22.5C4.98682 22.5 0.0620117 17.5752 0.0620117 11.5C0.0620117 5.4248 4.98682 0.5 11.062 0.5C17.1372 0.5 22.062 5.4248 22.062 11.5ZM20.062 11.5C20.062 16.4705 16.0325 20.5 11.062 20.5C6.09155 20.5 2.06201 16.4705 2.06201 11.5C2.06201 6.52954 6.09155 2.5 11.062 2.5C16.0325 2.5 20.062 6.52954 20.062 11.5Z",fill:"currentColor"})]})}function Et({id:t,commentCount:h,username:P,close:C}){const{User:v}=i.useContext(B),[u]=v,[m,f]=i.useState([]),[d,r]=i.useState(""),[n,l]=i.useState(null),[a,U]=i.useState(0),[y,_]=i.useState(!1),[T,w]=i.useState(!1),E=i.useRef(null),V=i.useRef(null);i.useEffect(()=>{L("TikTok",{action:"getComments",page:0,data:{id:t,creator:P}}).then(c=>{if(!(c!=null&&c.success))return g("warning",c.error);c.comments.length<15&&_(!0),f(c.comments)})},[]);const R=()=>{if(d.trim().length===0)return g("warning","Comment is empty");let c=n!=null&&n.isReplyToReply?`@${n.name} ${d}`:d;L("TikTok",{action:"postComment",data:{id:t,comment:c,replyTo:n==null?void 0:n.id}}).then(k=>{if(!(k!=null&&k.success))return g("warning",k.error);f(n?O=>O.map(p=>p.id==n.id?{...p,reply_count:p!=null&&p.reply_count?p.reply_count+1:1,replies:[{id:k.id,username:u.username,avatar:u.avatar,comment:c,timestamp:new Date().getTime(),likes:0,liked:!1,verified:u.verified},...(p==null?void 0:p.replies)||[]]}:p):O=>[{id:k.id,username:u.username,avatar:u.avatar,comment:c,timestamp:new Date().getTime(),likes:0,liked:!1,verified:u.verified},...O]),r(""),V.current.style.height="auto",l(null)})},A=()=>{if(y||T)return g("warning","Already fetched everything or is fetching");let c=document.querySelector("#last");if(!c)return g("warning","No last element");!ue(c)&&(w(!0),L("TikTok",{action:"getComments",page:a+1,data:{id:t,creator:P}}).then(O=>{if(!(O!=null&&O.success))return g("warning",O.error);O&&(O==null?void 0:O.comments.length)>0?(O.comments.length<15&&_(!0),f(p=>[...p,...O.comments]),w(!1)):(g("info","Fetched everything"),w(!1),_(!0))}),U(O=>O+1))};return i.useEffect(()=>{const c=k=>{const O=E.current;O.scrollTo({top:O.scrollTop+k.deltaY,behavior:"smooth"})};return E.current&&E.current.addEventListener("wheel",c),()=>{E.current&&E.current.removeEventListener("wheel",c)}},[E]),e("div",{className:"comments-container",onClick:()=>C(),children:s(ce.div,{...Te,className:"comments-wrapper",onClick:c=>c.stopPropagation(),children:[s("div",{className:"comments-header",children:[e("div",{}),e("div",{className:"title",children:o("APPS.TIKTOK.COMMENTS_TITLE").format({count:h})}),e("div",{className:"close",children:e(we,{onClick:C})})]}),e("div",{className:"comments-body",ref:E,onScroll:A,children:m.map((c,k)=>e(Ge,{comment:c,videoId:t,username:P,remove:()=>f(O=>O.filter(p=>p.id!=c.id)),setReplyTo:l,last:k==m.length-1},c.id))}),s("div",{className:"comments-footer",children:[e("img",{src:q(u.avatar)}),s("div",{className:"input",children:[e(ae,{maxLength:300,ref:V,value:d,onChange:c=>{r(c.target.value);let k=c.target.scrollHeight;c.target.style.height=k+"px"},onKeyDown:c=>{c.key=="Enter"&&R(),c.key==" "&&r(k=>k+" ")},placeholder:n?o("APPS.TIKTOK.REPLY_TO").format({name:n.name}):o("APPS.TIKTOK.ADD_COMMENT")}),e("span",{onClick:()=>{W.Emoji.set({onSelect:c=>r(k=>k+c.emoji)})},children:e(Lt,{})}),d.trim().length>0&&e("span",{children:e(De,{onClick:R})})]})]})]})})}const Ge=({videoId:t,username:h,comment:P,remove:C,setReplyTo:v,last:u})=>{var k,O,p;const{User:m}=i.useContext(B),[f,d]=m,[r,n]=i.useState(P),[l,a]=i.useState(r.likes),[U,y]=i.useState(r.liked===1),[_,T]=i.useState(r.creator_liked===1);i.useState(0),i.useState(!1),i.useState(!1);const[w,E]=i.useState(!1);i.useEffect(()=>{P&&n(P)},[P]);const V=()=>{L("TikTok",{action:"getComments",page:0,data:{id:t,replyTo:r.id,creator:h}}).then(N=>{if(!(N!=null&&N.success))return g("warning",N.error);n(F=>({...F,replies:[...(F==null?void 0:F.replies)??[],...N.comments.filter(x=>F!=null&&F.replies?!F.replies.some(M=>M.id===x.id):!0)]})),E(!0)})},R=()=>{L("TikTok",{action:"toggleLikeComment",id:r.id,toggle:!U}).then(N=>{if(!(N!=null&&N.success))return g("warning",N.error);f.username===h&&T(F=>!F),y(F=>!F),n(F=>({...F,liked:!U}))})};le("tiktok:updateCommentLikes",N=>{N.id===r.id&&a(F=>N.method==="add"?F+1:F-1)});let A=r.username!==f.username||h!==r.username||f.isAdmin;const c=je(N=>{if(N.stopPropagation(),N.preventDefault(),!A)return g("warning","You cannot click to this comment!");let F=[(f.isAdmin||f.username===r.username)&&{title:o("APPS.TIKTOK.DELETE_COMMENT"),color:"red",cb:()=>{L("TikTok",{action:"deleteComment",id:r.id,videoId:t}).then(x=>{if(!(x!=null&&x.success))return g("warning",x.error);C()})}}];W.ContextMenu.set({buttons:F})});return s("div",{className:"item",id:u?"last":"","data-clickable":A,"data-id":r.id,children:[s("div",{className:"comment-info",...c,children:[e("div",{className:"avatar",children:e("img",{src:q(r.avatar)})}),s("div",{className:"comment-data",children:[s("div",{className:"username",children:[r.username,r.verified&&e(de,{}),r.username===h&&e("div",{className:"creator-badge",children:o("APPS.TIKTOK.CREATOR")})]}),e("div",{className:"comment",children:r.comment}),s("div",{className:"actions",children:[e("div",{className:"timestamp",children:Ce(r.timestamp)}),e("div",{className:"reply",onClick:()=>{v(()=>({id:r.replyTo??r.id,name:r.username,isReplyToReply:r.replyTo!==void 0}))},children:o("APPS.TIKTOK.REPLY")})]}),_&&e("div",{className:"creator-liked",children:o("APPS.TIKTOK.LIKED_BY_CREATOR")})]})]}),(r.reply_count>0||r.replies)&&s("div",{className:"replies",children:[(k=r.replies)==null?void 0:k.map(N=>e(Ge,{videoId:t,username:h,comment:{...N,replyTo:r.id},remove:()=>{n(F=>{var x;return{...F,reply_count:F.reply_count-1,replies:(x=F.replies)==null?void 0:x.filter(M=>M.id!==N.id)}})},setReplyTo:v})),!w&&((O=r.replies)==null?void 0:O.length)!==r.reply_count&&s("div",{className:"view-replies",onClick:V,children:[o("APPS.TIKTOK.VIEW_REPLIES")," ",s("b",{children:["(",r!=null&&r.replies?r.reply_count-(((p=r.replies)==null?void 0:p.length)??0):r.reply_count,")"]})," ",e(Ve,{})]})]}),s("div",{className:"likes","data-active":U,onClick:R,children:[U?e(Oe,{}):e(He,{}),Y(l)]})]})};function _t({className:t}){return s("svg",{className:t,width:"43",height:"36",viewBox:"0 0 43 36",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[s("g",{filter:"url(#filter0_d_4_1154)",children:[e("path",{d:"M37.9988 19.0845C38.4285 18.6965 38.4399 18.0257 38.0236 17.6233L24.7382 4.78295C24.1035 4.16949 23.0432 4.61928 23.0432 5.50199V10.8621C18.0772 10.7853 14.3463 12.0842 11.5737 14.0746C8.75779 16.0962 6.9636 18.807 5.858 21.4345C4.75341 24.0595 4.32774 26.6203 4.25995 28.3761C4.22652 29.242 4.27816 29.9566 4.40223 30.3933C4.43394 30.5048 4.47678 30.622 4.53837 30.7255C4.59258 30.8167 4.70727 30.9754 4.91565 31.0417C5.16639 31.1214 5.37921 31.0191 5.50256 30.9132C5.61389 30.8176 5.6887 30.6943 5.74047 30.5908L5.74705 30.5777L5.75234 30.5653L5.75284 30.5641L5.75411 30.5613L5.76432 30.5391C5.77418 30.518 5.79023 30.4845 5.81294 30.44C5.85837 30.3509 5.93042 30.2173 6.03287 30.049C6.23783 29.7123 6.56409 29.237 7.04199 28.6994C7.99659 27.6255 9.55921 26.2993 11.979 25.3314C13.3564 24.7805 15.6523 24.5297 17.9033 24.4891C20.0514 24.4504 22.0549 24.6041 23.0432 24.822V30.3392C23.0432 31.2058 24.0703 31.6622 24.7134 31.0814L37.9988 19.0845Z",fill:"currentColor"}),e("path",{d:"M33.906 17.6574C34.8657 16.5418 33.906 14.9506 33.906 14.9506L32.25 12.0469L24.7382 4.78295C24.1035 4.16949 23.0432 4.61928 23.0432 5.50199V10.8621C18.0772 10.7853 14.3463 12.0842 11.5737 14.0746C8.75779 16.0962 6.9636 18.807 5.858 21.4345C4.75341 24.0595 4.32774 26.6203 4.25995 28.3761C4.22652 29.242 4.27816 29.9566 4.40223 30.3933C4.43394 30.5048 4.47678 30.622 4.53837 30.7255C4.59258 30.8167 4.70727 30.9754 4.91565 31.0417C5.16639 31.1214 5.37921 31.0191 5.50256 30.9132C5.61389 30.8176 5.6887 30.6943 5.74047 30.5908L5.74705 30.5777L5.75234 30.5653L5.75284 30.5641L5.75411 30.5613L5.76432 30.5391C5.77418 30.518 5.79023 30.4845 5.81294 30.44C5.85837 30.3509 5.93042 30.2173 6.03287 30.049C6.23783 29.7123 6.56409 29.237 7.04199 28.6994C7.99659 27.6255 13.2932 23.8672 16.2932 22.3672C18.7932 20.8672 23.0432 19.8672 23.0432 19.8672V25.8672C23.0432 26.7337 24.0703 27.1901 24.7134 26.6094L33.906 17.6574Z",fill:"currentColor"})]}),e("defs",{children:s("filter",{id:"filter0_d_4_1154",x:"0.25",y:"0.83",width:"42.0786",height:"34.8412",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[e("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),e("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),e("feOffset",{dy:"0.33"}),e("feGaussianBlur",{stdDeviation:"2"}),e("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),e("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_4_1154"}),e("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_4_1154",result:"shape"})]})})]})}function Ae({data:t,active:h,preview:P}){var G,X,ee;const{User:C,Func:v,ShareComponent:u,GoBack:m}=i.useContext(B),f=ve(re.Settings),[d]=C,[r,n]=u,[l,a]=i.useState(t==null?void 0:t.liked),[U,y]=i.useState(t==null?void 0:t.saved),[_,T]=i.useState(t==null?void 0:t.viewed),[w,E]=i.useState(t==null?void 0:t.likes),[V,R]=i.useState(t==null?void 0:t.saves),[A,c]=i.useState(t==null?void 0:t.comments),[k,O]=i.useState(!1),p=i.useRef(null),N=i.useRef(null),F=i.useRef(0),[x,M]=i.useState(!1),[j,te]=i.useState(!1),S=ve(Ie.LockScreenVisible);i.useEffect(()=>{var I,D;return h&&((I=t.music)!=null&&I.path&&Z(),(D=t.metadata)!=null&&D.tts&&$()),()=>{p!=null&&p.current&&p.current.pause(),N!=null&&N.current&&N.current.pause(),_||L("TikTok",{action:"setViewed",id:t.id}).then(()=>{T(!0)})}},[h]),i.useEffect(()=>{const I=document.querySelector(".video video");S?(p!=null&&p.current&&p.current.pause(),N!=null&&N.current&&N.current.pause(),I==null||I.pause()):(p!=null&&p.current&&p.current.play(),N!=null&&N.current&&N.current.play(),I==null||I.play())},[S]);const $=()=>{var D;if(!t.metadata.ttsUrl)return;p!=null&&p.current&&(p.current.pause(),p.current=null);const I=new Audio;I.src=t.metadata.ttsUrl,I.volume=(((D=f==null?void 0:f.sound)==null?void 0:D.volume)??.5)/2,I.play(),p.current=I},Z=()=>{var D,Q;const I=new Audio;N!=null&&N.current&&(N.current.pause(),N.current=null),I.src=(D=t.music.path)!=null&&D.includes("http")?t.music.path:`./assets/sound/songs/${t.music.path}`,I.volume=t.music.volume*(((Q=f==null?void 0:f.sound)==null?void 0:Q.volume)??1),I.play(),N.current=I};i.useEffect(()=>{var I,D,Q;(I=f==null?void 0:f.sound)!=null&&I.volume&&(N!=null&&N.current&&(N.current.volume=t.music.volume*(((D=f==null?void 0:f.sound)==null?void 0:D.volume)??1)),p!=null&&p.current&&(p.current.volume=(((Q=f==null?void 0:f.sound)==null?void 0:Q.volume)??.5)/2))},[(G=f==null?void 0:f.sound)==null?void 0:G.volume]);const ne=()=>{P||L("TikTok",{action:"toggleLike",id:t.id,toggle:!l}).then(I=>{if(!I.success)return g("warning",I.error);a(!l)})},J=()=>{P||-L("TikTok",{action:"toggleSave",id:t.id,toggle:!U}).then(I=>{if(!I.success)return g("warning",I.error);y(!U)})};le("tiktok:updateLikes",I=>{if(I&&I.id===t.id)return E(D=>D+(I.method==="add"?1:-1))}),le("tiktok:updateSaves",I=>{if(I&&I.id===t.id)return R(D=>D+(I.method==="add"?1:-1))}),le("tiktok:updateComments",I=>{if(I&&I.id===t.id)return c(D=>(I.count=I.count??1,D+(I.method==="add"?I.count:-I.count)))});const b=I=>{if(I.detail===1)return te(!j);if(I.detail===2){if(!t.id)return;l||(ne(),M(!0),setTimeout(()=>{M(!1)},1e3))}};return i.useEffect(()=>{const I=document.querySelector(".video video");I&&(j?(I.pause(),p!=null&&p.current&&p.current.pause(),N!=null&&N.current&&N.current.pause(),g("info","paused everything")):(I.play(),p!=null&&p.current&&p.current.play(),N!=null&&N.current&&N.current.play(),g("info","playing everything")))},[j]),s(z,{children:[e(he,{children:k&&!P&&e(Et,{id:t.id,username:t.username,commentCount:A,close:()=>O(!1)})}),s("div",{className:"video","data-active":h,onClick:b,children:[x&&e("div",{className:oe("popup-heart",x?"show":"hide"),children:e("svg",{color:"#e3e3e3",fill:"#e3e3e3",height:"24",viewBox:"0 0 48 48",width:"24",children:e("path",{d:"M34.6 3.1c-4.5 0-7.9 1.8-10.6 5.6-2.7-3.7-6.1-5.5-10.6-5.5C6 3.1 0 9.6 0 17.6c0 7.3 5.4 12 10.6 16.5.6.5 1.3 1.1 1.9 1.7l2.3 2c4.4 3.9 6.6 5.9 7.6 6.5.5.3 1.1.5 1.6.5s1.1-.2 1.6-.5c1-.6 2.8-2.2 7.8-6.8l2-1.8c.7-.6 1.3-1.2 2-1.7C42.7 29.6 48 25 48 17.6c0-8-6-14.5-13.4-14.5z"})})}),e("video",{src:t.src,autoPlay:!0,loop:!0,muted:!h,onTimeUpdate:I=>{var D,Q;h&&(I.target.currentTime<F.current&&((D=t==null?void 0:t.music)!=null&&D.path&&Z(),(Q=t==null?void 0:t.metadata)!=null&&Q.ttsUrl&&(p.current.currentTime=0,p.current.play())),F.current=I.target.currentTime)}}),s("div",{className:"video-info",children:[s("div",{className:"user",children:[s("div",{className:"username",onClick:()=>{if(!P)return v.fetchAndSetProfile(t.username)},children:[t.name??`@${t.username}`,t.verified&&e(de,{})]}),s("span",{children:[" • ",Ce(t.timestamp)]})]}),e("div",{className:"caption",children:t.caption}),((X=t==null?void 0:t.music)==null?void 0:X.title)&&s("div",{className:"song",children:[e(ze,{})," ",t.music.artist," - ",t.music.title]})]}),s("div",{className:"video-actions",children:[e("img",{className:"profile",src:q(t.avatar),onClick:()=>{if(!P)return v.fetchAndSetProfile(t.username)}}),s("div",{className:"action",onClick:()=>ne(),"data-active":l,children:[e(Oe,{className:"like"}),Y(w)]}),s("div",{className:"action",onClick:()=>O(!0),children:[e(Be,{className:"comment"}),Y(A)]}),s("div",{className:"action",onClick:()=>J(),"data-active":U,children:[e(Re,{className:"save"}),Y(V)]}),e("div",{className:"action",onClick:()=>{n({id:t.id,src:t.src,username:t.username,pinned:t.pinned})},children:(d==null?void 0:d.username)===t.username?e(Je,{className:"manage"}):s(z,{children:[e(_t,{className:"share"}),o("APPS.TIKTOK.SHARE")]})}),e("div",{className:"song",children:e("img",{src:((ee=t==null?void 0:t.music)==null?void 0:ee.cover)??"./assets/img/icons/music/unknown.png"})})]})]})]})}function Ut(){const{User:t,Profile:h,View:P,LoggedIn:C,UserPanel:v,Func:u,GoBack:m,Dm:f}=i.useContext(B),[d,r]=t,[n,l]=h,[a,U]=C,[y,_]=v,[T,w]=m,[E,V]=f,[R,A]=P,[c,k]=i.useState([]),[O,p]=i.useState(!1),[N,F]=i.useState("recent"),[x,M]=i.useState(0),[j,te]=i.useState(!1),[S,$]=i.useState(!1),[Z,ne]=i.useState((n==null?void 0:n.follower_count)||0),[J,b]=i.useState((n==null?void 0:n.following_count)||0),G=[{value:"recent",icon:e(Xe,{})},{value:"liked",icon:n!=null&&n.show_likes?e(Qe,{}):e(et,{})},{value:"saved",hidden:(d==null?void 0:d.username)!==(n==null?void 0:n.username),icon:e(Re,{})}],X=[{label:o("APPS.TIKTOK.FOLLOWING"),name:"following",value:n==null?void 0:n.following_count},{label:o("APPS.TIKTOK.FOLLOWERS"),name:"followers",value:n==null?void 0:n.follower_count},{label:o("APPS.TIKTOK.LIKES"),value:n==null?void 0:n.like_count}];i.useEffect(()=>{if(n){if(M(0),ne((n==null?void 0:n.follower_count)||0),b((n==null?void 0:n.following_count)||0),N==="liked"&&!(n!=null&&n.show_likes)&&d.username!==n.username)return k([]);L("TikTok",{action:"getVideos",data:{full:!1,username:n.username,type:N},page:0}).then(K=>{if(!K)return g("warning","Failed to get videos");k(K)})}},[N,n==null?void 0:n.username]);const ee=()=>{if(S||j)return g("warning","Already fetched everything or is fetching");let K=document.querySelector("#last");if(!K)return g("warning","No last element");!ue(K)&&(te(!0),L("TikTok",{action:"getVideos",data:{full:!1,username:n.username,type:N},page:x+1}).then(se=>{se&&se.length>0?(k(ge=>[...ge,...se]),te(!1)):(g("info","Fetched everything"),te(!1),$(!0))}),M(se=>se+1))},I=K=>{L("TikTok",{action:"toggleFollow",data:{username:n.username,follow:K}}).then(H=>{if(!H||!(H!=null&&H.success))return g("warning","Failed to toggle follow");if(H.error)return g("error",H.error);g("info",`Toggling follow to ${K}`),l({...n,isFollowing:K})})};le("tiktok:updateFollowers",K=>{if(!K||K.username!==n.username)return;let H=Z+(K.method==="add"?1:-1);l({...n,follower_count:H}),ne(H)}),le("tiktok:updateFollowing",K=>{if(!K||K.username!==n.username)return;let H=J+(K.method==="add"?1:-1);l({...n,following_count:H}),b(H)});const D=()=>{d.username===n.username&&L("AccountSwitcher",{action:"getAccounts",app:"TikTok"}).then(K=>{var ge;if(!K)return g("info","No accounts found");let H=d.isAdmin,se=(ge=K==null?void 0:K.filter(fe=>fe!==d.username))==null?void 0:ge.map(fe=>({title:fe,cb:()=>{fe!==d.username&&L("AccountSwitcher",{action:"switch",app:"TikTok",account:fe}).then(()=>{L("TikTok",{action:"isLoggedIn"}).then(Se=>{Se?(ie.APPS.TIKTOK.account.set(Se),r({...Se,isAdmin:H}),A("feed"),U(!0)):ie.APPS.TIKTOK.account.set(null)})})}}));W.ContextMenu.set({buttons:[...se,{title:o("APPS.TIKTOK.ADD_ACCOUNT_TITLE"),cb:()=>{U(!1)}}]})})},Q=K=>{r(K),l(K),p(!1)},pe=()=>{d.username!==n.username&&L("TikTok",{action:"getChannelId",username:n.username}).then(K=>{V({id:K.id,username:n.username,name:n.name,avatar:n.avatar,follower_count:n.follower_count,following_count:n.following_count,isFollowing:n.isFollowing}),w({view:"profile",data:{identifier:"profile",data:n}}),A("dm"),l(null)})};return n?s(z,{children:[e(he,{children:O&&e(bt,{close:K=>Q(K)})}),s(ce.div,{...tt,className:"profile-container",children:[s("div",{className:"profile-header",children:[n.username===d.username?e("span",{}):e("div",{children:e(me,{className:"go-back",onClick:()=>{var K,H;if(T!=null&&T.view){if(T!=null&&T.data)switch((K=T==null?void 0:T.data)==null?void 0:K.identifier){case"dm":V((H=T==null?void 0:T.data)==null?void 0:H.data),A("dm");break;default:A("feed"),l(null)}else A(T==null?void 0:T.view);w(null)}else A("feed");l(null)}})}),s("div",{className:"name",onClick:D,children:[n.name,d.username===n.username&&e(Ve,{})]}),e("span",{})]}),s("div",{className:"profile-info",onScroll:ee,children:[e("div",{className:"avatar",children:e("img",{src:q(n.avatar)})}),s("div",{className:"username",children:["@",n.username,n.verified&&e(de,{})]}),e("div",{className:"stats",children:X.map((K,H)=>{let se={followers:Z,following:J};return s("div",{className:"item","data-cursor":K.name!==void 0,onClick:()=>{K.name&&_({value:K.name,username:n.username,following:J,followers:Z})},children:[e("div",{className:"value",children:Y(se[K.name]??n.like_count)}),e("div",{className:"label",children:K.label})]},H)})}),s("div",{className:"actions",children:[d.username===n.username?e("div",{className:"button big",onClick:()=>p(!0),children:o("APPS.TIKTOK.EDIT_PROFILE")}):e(z,{children:n.isFollowing?s(z,{children:[e("div",{className:oe("button","big"),onClick:pe,children:o("APPS.TIKTOK.MESSAGE")}),e("div",{className:"button",onClick:()=>{W.PopUp.set({title:o("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:o("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:n.name}),buttons:[{title:o("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:o("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>I(!1)}]})},children:e(nt,{})})]}):s(z,{children:[e("div",{className:"button follow",onClick:()=>I(!0),children:o("APPS.TIKTOK.FOLLOW")}),e("div",{className:"button",onClick:pe,children:e(ye,{})})]})}),n.instagram&&e("div",{className:"button",onClick:()=>{re.App.set({name:"Instagram",view:"profile",data:{username:n.instagram}})},children:e(it,{})}),n.twitter&&e("div",{className:"button",onClick:()=>{re.App.set({name:"Twitter",view:"profile",data:{username:n.twitter}})},children:e(st,{})})]}),e("div",{className:"bio",children:n.bio}),s("div",{className:"profile-videos",children:[e("div",{className:"navbar",children:G.filter(K=>!K.hidden).map(K=>e("div",{className:oe("item",N===K.value&&"active"),onClick:()=>F(K.value),children:K.icon}))}),s("div",{className:"feed",children:[N==="liked"&&!(n!=null&&n.show_likes)&&d.username!==n.username&&s("div",{className:"private",children:[e("div",{className:"title",children:o("APPS.TIKTOK.LIKED_HIDDEN_TITLE")}),e("div",{className:"subtitle",children:o("APPS.TIKTOK.LIKED_HIDDEN_SUBTITLE").format({name:n.username})})]}),c.map((K,H)=>e(Ft,{data:K,last:H===c.length-1,onClick:()=>{w({...T,ignoreFeed:!0}),u.fetchAndSetVideo(K.id,{username:n.username,id:K.id,type:N})}}))]})]})]})]})]}):null}const Ft=({data:t,last:h,onClick:P})=>s("div",{className:"item",onClick:P,id:h?"last":"",children:[e("video",{src:t.src,loop:!0,onMouseEnter:C=>C.currentTarget.play(),onMouseLeave:C=>C.currentTarget.pause(),muted:!0}),t.pinned===1&&e("div",{className:"pinned",children:"Pinned"}),s("div",{className:"views",children:[e(Fe,{}),Y(t.views)]})]}),bt=t=>{const{User:h,LoggedIn:P,View:C}=i.useContext(B),[v,u]=h,[m,f]=P,[d,r]=i.useState(null),n=["instagram","twitter"];i.useEffect(()=>{r({name:v.name,bio:v.bio,avatar:v.avatar,instagram:v.instagram,twitter:v.twitter,show_likes:v.show_likes})},[]);const l=()=>{L("TikTok",{action:"updateProfile",data:d}).then(a=>{if(!a)return g("warning","No response from server");if(a.success)ie.APPS.TIKTOK.account.set({...v,...d}),t.close({...v,...d});else switch(g("error",a.error),a.error){case"invalid_twitter":W.PopUp.set({title:o("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.TITLE").format({name:o("APPS.TWITTER.TITLE")}),description:o("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.DESCRIPTION").format({name:o("APPS.TWITTER.TITLE".toLocaleLowerCase())}),buttons:[{title:o("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.OK")}]});break;case"invalid_instagram":W.PopUp.set({title:o("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.TITLE").format({name:o("APPS.INSTAGRAM.TITLE")}),description:o("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.DESCRIPTION").format({name:o("APPS.INSTAGRAM.TITLE").toLocaleLowerCase()}),buttons:[{title:o("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.OK")}]})}})};return s(ce.div,{...Te,className:"edit-profile-container",children:[s("div",{className:"edit-profile-header",children:[e("div",{children:e(me,{onClick:l})}),e("div",{className:"title",children:o("APPS.TIKTOK.EDIT_PROFILE")}),e("span",{})]}),s("div",{className:"edit-profile-content",children:[s("div",{className:"avatar",children:[s("div",{className:"image",onClick:()=>W.Gallery.set({onSelect:a=>{r({...d,avatar:a.src})}}),children:[e("img",{src:q(d==null?void 0:d.avatar)}),e(ot,{})]}),o("APPS.TIKTOK.CHANGE_PHOTO")]}),s("div",{className:"form",children:[s("div",{className:"item",children:[e("div",{className:"label",children:o("APPS.TIKTOK.NAME")}),e(ae,{type:"text",defaultValue:d==null?void 0:d.name,onChange:a=>{a.target.value.length<=30&&r({...d,name:a.target.value})}})]}),s("div",{className:"item",children:[e("div",{className:"label",children:o("APPS.TIKTOK.USERNAME")}),e(ae,{type:"text",disabled:!0,value:v.username})]}),s("div",{className:"item",children:[e("div",{className:"label",children:o("APPS.TIKTOK.BIO")}),e(Me,{placeholder:o("APPS.TIKTOK.ADD_TO_YOUR_PROFILE"),defaultValue:d==null?void 0:d.bio,onChange:a=>{a.target.value.length<=150&&r({...d,bio:a.target.value})}})]}),e("div",{className:"break"}),n.map((a,U)=>s("div",{className:"item",children:[e("div",{className:"label",children:Le(a)}),e("div",{className:"value",onClick:()=>{d!=null&&d[a]?W.PopUp.set({title:o("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.TITLE").format({name:o(`APPS.${a.toUpperCase()}.TITLE`)}),description:o("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.DESCRIPTION").format({name:o(`APPS.${a.toUpperCase()}.TITLE`)}),buttons:[{title:o("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.CANCEL")},{title:o("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.PROCEED"),color:"red",cb:()=>{r({...d,[a]:null})}}]}):L("AccountSwitcher",{action:"getAccounts",app:Le(a)}).then(y=>{y||g("info","No accounts found");let _=(y==null?void 0:y.map(T=>({title:T,cb:()=>{r({...d,[a]:T})}})))??[];W.ContextMenu.set({buttons:[..._]})})},children:d!=null&&d[a]?`@${d==null?void 0:d[a]}`:o("APPS.TIKTOK.ADD_ACCOUNT").format({name:o(`APPS.${a.toUpperCase()}.TITLE`)})})]},U)),e("div",{className:"break"}),s("div",{className:"item",children:[e("div",{className:"label",children:o("APPS.TIKTOK.SHOW_LIKES")}),e(mt,{checked:d==null?void 0:d.show_likes,onChange:()=>{r({...d,show_likes:!(d!=null&&d.show_likes)})}})]})]}),e("div",{className:"logout-button",onClick:()=>{W.PopUp.set({title:o("APPS.INSTAGRAM.SIGN_OUT_POPUP.TITLE"),description:o("APPS.INSTAGRAM.SIGN_OUT_POPUP.DESCRIPTION"),buttons:[{title:o("APPS.INSTAGRAM.SIGN_OUT_POPUP.CANCEL")},{title:o("APPS.INSTAGRAM.SIGN_OUT_POPUP.PROCEED"),color:"red",cb:()=>{L("TikTok",{action:"logout"}).then(a=>{if(!a)return g("warning","Failed to logout");ie.APPS.TIKTOK.account.set(null),f(!1)})}}]})},children:o("APPS.TIKTOK.LOGOUT")})]})]})};function yt(){var T,w,E,V,R,A;const{View:t,User:h}=i.useContext(B),[P]=h,[C,v]=t,[u,m]=i.useState(0),[f,d]=i.useState(!1),[r,n]=i.useState("en_us_001"),[l,a]=i.useState({src:null,caption:null,music:{title:null,artist:null,path:null,cover:null,volume:.25},metadata:{tts:null,ttsUrl:null,ttsVoice:null}}),[U,y]=i.useState(!1);i.useEffect(()=>{y(l.src&&l.caption)},[l]),i.useEffect(()=>{var c,k,O;switch(u){case 0:W.Gallery.set({allowExternal:(O=(k=(c=Ee)==null?void 0:c.value)==null?void 0:k.AllowExternal)==null?void 0:O.TikTok,includeVideos:!0,includeImages:!1,onSelect:p=>{a({...l,src:p.src}),m(N=>N+1)}});break}},[u]);const _=()=>{var c,k;L("TikTok",{action:"uploadVideo",data:{src:l.src,caption:l.caption,metadata:((c=l.metadata)==null?void 0:c.ttsUrl)&&l.metadata,music:((k=l.music)==null?void 0:k.path)&&{path:l.music.path,volume:l.music.volume}}}).then(O=>{if(!O||O.error)return g("warning","Failed to upload video, error: "+O.error);if(!O.success)return g("warning","Failed to upload video");v("feed")})};return s("div",{className:"upload-container",children:[f&&e("div",{className:"loading",children:e(xe,{size:40,lineWeight:5,speed:2,color:((w=(T=re.Settings)==null?void 0:T.value)==null?void 0:w.display.theme)==="dark"?"#fff":"#000"})}),u!==0&&s(z,{children:[s("div",{className:"upload-header",children:[e("div",{className:"cancel",onClick:()=>{if(u===2)return m(c=>c-1);if(u===1)return v("feed")},children:u===2?o("APPS.TIKTOK.GO_BACK"):o("APPS.TIKTOK.CANCEL")}),e("div",{className:"title",children:o("APPS.TIKTOK.UPLOAD_VIDEO")}),e("div",{className:"next","data-disabled":!U,onClick:()=>{if(U){if(u===2)return _();l!=null&&l.metadata.tts?(d(!0),Vt(l.metadata.tts,r).then(c=>{d(!1),a({...l,metadata:{...l.metadata,ttsUrl:c}}),m(k=>k+1)}).catch(c=>{d(!1),W.PopUp.set({title:o("APPS.TIKTOK.FAILED_UPLOAD_POPUP.TITLE"),description:o("APPS.TIKTOK.FAILED_UPLOAD_POPUP.DESCRIPTION"),buttons:[{title:o("APPS.TIKTOK.FAILED_UPLOAD_POPUP.CANCEL")},{title:o("APPS.TIKTOK.FAILED_UPLOAD_POPUP.PROCEED"),cb:()=>{m(k=>k+1)}}]})})):m(c=>c+1)}},children:u===1?o("APPS.TIKTOK.PREVIEW"):o("APPS.TIKTOK.SHARE")})]}),s("div",{className:"upload-body",children:[u===1&&s(z,{children:[e("div",{className:"video-placeholder",children:e("video",{src:l.src,controls:!1,autoPlay:!0,loop:!0,muted:!0})}),s("div",{className:"form",children:[s("div",{className:"item",children:[e("div",{className:"label",children:o("APPS.TIKTOK.CAPTION")}),e(ae,{defaultValue:l.caption,placeholder:o("APPS.TIKTOK.CAPTION_PLACEHOLDER"),type:"text",maxLength:100,onChange:c=>{if(c.target.value.length<=100)return a({...l,caption:c.target.value})}})]}),s("div",{className:"item",children:[s("div",{className:"label",children:[o("APPS.TIKTOK.TTS")," ",s("span",{children:["(",o("APPS.TIKTOK.OPTIONAL"),")"]})]}),e(Me,{defaultValue:(E=l==null?void 0:l.metadata)==null?void 0:E.tts,placeholder:o("APPS.TIKTOK.TTS_PLACEHOLDER"),maxLength:300,onChange:c=>{if(c.target.value.length<=300)return a({...l,metadata:{...l.metadata,tts:c.target.value}})}}),((V=l==null?void 0:l.metadata)==null?void 0:V.tts)&&e("select",{onChange:c=>{n(c.target.value)},children:(R=Ee)==null?void 0:R.value.TikTokTTS.map(c=>e("option",{value:c[1],selected:c[1]===r,children:c[0]}))})]}),s("div",{className:"item",children:[s("div",{className:"label",children:[o("APPS.TIKTOK.MUSIC")," ",s("span",{children:["(",o("APPS.TIKTOK.OPTIONAL"),")"]})]}),s("div",{className:"button",onClick:()=>W.MusicSelector.set({onSelect:c=>a({...l,music:{...l.music,...c}})}),children:[l.music?l.music.title:o("APPS.TIKTOK.SELECT_MUSIC"),e(we,{onClick:c=>{c.stopPropagation(),a({...l,music:null})}})]}),((A=l.music)==null?void 0:A.title)&&s("div",{className:"slider",children:[e(lt,{}),e(ft,{min:0,max:.5,step:.025,value:l.music.volume??.25,onChange:c=>a({...l,music:{...l.music,volume:c}})}),e(at,{})]})]})]})]}),u===2&&e("div",{className:"preview",children:e(Ae,{data:{...l,timestamp:new Date().getTime(),id:"preview",likes:0,comments:0,saves:0,username:P.username,avatar:q(P.avatar),verified:P.verified,music:l.music},active:!0,preview:!0})})]})]})]})}const Dt=(t,h)=>new Promise((P,C)=>{fetch("https://tiktok-tts.weilnet.workers.dev/api/generation",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({text:t,voice:h})}).then(v=>v.json()).then(v=>{v!=null&&v.success&&(v!=null&&v.data)?P(v==null?void 0:v.data):C(v)}).catch(v=>{fetch("https://tiktoktts.com/api/functions",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:1,jsonrpc:"2.0",method:"generateTikTokVoice",params:[{text:t,voice:h}]})}).then(u=>u.json()).then(u=>{var m,f;(m=u==null?void 0:u.result)!=null&&m.base64?P((f=u==null?void 0:u.result)==null?void 0:f.base64):C(u)}).catch(u=>{C(u)})})}),Vt=(t,h)=>new Promise((P,C)=>{Dt(t,h).then(v=>{const u=atob(v),m=new ArrayBuffer(u.length),f=new Uint8Array(m);for(let r=0;r<u.length;r++)f[r]=u.charCodeAt(r);const d=new Blob([f],{type:"audio/mp3"});rt("Audio",d).then(r=>{P(r)}).catch(r=>{C(r)})}).catch(v=>{C(v)})});function _e(){var ne,J;const{View:t,Profile:h,FeedData:P,Func:C,GoBack:v}=i.useContext(B),u=ve(re.Settings),[m,f]=(ne=i.useContext(ct).Func)==null?void 0:ne.TextColor,[d,r]=t,[n,l]=P,[a,U]=v,[y,_]=i.useState(0),[T,w]=i.useState(!1),[E,V]=i.useState(!1),[R,A]=i.useState("recent"),[c,k]=i.useState([]),[O,p]=i.useState(0),N=i.useRef(null);i.useEffect(()=>{var b;if(d!=="feed"){F.current=!0;return}return _(0),V(!1),w(!1),k([]),(b=n==null?void 0:n.args)!=null&&b.single?(k([n.video]),p(0),M.current=0):L("TikTok",{action:"getVideos",page:0,data:{full:!0,type:R,...n==null?void 0:n.args}}).then(G=>{if(!G)return g("warning","No videos found");G.length<5&&V(!0),n&&(n!=null&&n.video)&&G.unshift(n.video),p(0),M.current=0,k(G)}),f("#ffffff"),()=>{f(u.display.theme==="dark"?"#ffffff":"#000000"),re.SoundManager.reset(),l(null)}},[d]);const F=i.useRef(!0);i.useEffect(()=>{if(!n){if(F.current){F.current=!1;return}k([]),L("TikTok",{action:"getVideos",page:0,data:{full:!0,type:R}}).then(b=>{if(!b)return g("warning","No videos found");b.length<5&&V(!0),k(b),M.current=0,p(0)})}},[R,n]);const x=i.useRef(!1),M=i.useRef(0);i.useEffect(()=>{M.current=0,p(0),_(0),V(!1),w(!1)},[R]),i.useEffect(()=>{if(c.length===0)return g("info","No videos found");if(c.length===1||c.length-2===O){if(g("info","fetching more videos: "+JSON.stringify(n)),n!=null&&n.single)return;if(T||E)return g("info","Already fetching or fetched everything");w(!0),L("TikTok",{action:"getVideos",page:y+1,data:{full:!0,type:R,...n==null?void 0:n.args}}).then(b=>{b&&b.length>0?(b.length<5&&V(!0),k(G=>[...G,...b]),w(!1)):(g("info","Fetched everything"),w(!1),V(!0)),_(G=>G+1)})}},[O]),i.useEffect(()=>{if(!c||c.length===0)return;const b=()=>{if(!x.current)return requestAnimationFrame(b);const D=dt(u.display.size);x.current=!1;const Q=N.current,K=document.querySelector(".video").getBoundingClientRect().height/D,H=M.current*K;g("info",`Target scroll position: ${H}, current scroll position: ${Q.scrollTop}, snapIndex: ${M.current}`),Q.scrollTo({top:H,behavior:"smooth"}),p(M.current),requestAnimationFrame(b)};requestAnimationFrame(b);const G=D=>{D.preventDefault(),j(D)},X=["ArrowUp","ArrowDown","Space"],ee=D=>{(X.includes(D.key)||X.includes(D.code))&&(document.querySelector(".tiktok-content")||D.preventDefault()),(D.key==="ArrowUp"||D.key==="ArrowDown")&&te(D.key==="ArrowUp"?-1:1)},I=N.current;return I.addEventListener("wheel",G,{passive:!1}),window.addEventListener("keydown",ee),()=>{I.removeEventListener("wheel",G),window.removeEventListener("keydown",ee)}},[c]);const j=b=>{if(b.preventDefault(),$())return;const X=b.deltaY<0?-1:1;te(X)},te=b=>{const X=c.length-1,ee=M.current+b;ee>=0&&ee<=X?(M.current=ee,x.current=!0,g("info","Scrolling to video: "+M.current)):ee<0?g("info","Top of the feed, trying to scroll up?"):g("info","Reached the bottom of the feed")},S=b=>{b.button===1&&b.preventDefault()},$=()=>!!document.querySelector(".comments-container");let Z=d==="feed";return s("div",{className:"tiktok-feed",style:{visibility:Z?"visible":"hidden"},children:[!n&&e("div",{className:"feed-header",children:s("div",{className:"feed-header-content",children:[e("div",{className:oe("item",R=="following"&&"active"),onClick:()=>A("following"),children:o("APPS.TIKTOK.FOLLOWING")}),e("div",{className:oe("item",R=="recent"&&"active"),onClick:()=>A("recent"),children:o("APPS.TIKTOK.FOR_YOU")}),e("div",{className:"border","data-direction":R==="recent"?"right":"left"})]})}),R==="following"&&c.length===0&&e("div",{className:"no-following",children:o("APPS.TIKTOK.NO_FOLLOWING_TITLE")}),(((J=n==null?void 0:n.args)==null?void 0:J.username)||(a==null?void 0:a.view))&&e(me,{className:"go-back",onClick:()=>{l(null),a!=null&&a.view&&!(a!=null&&a.ignoreFeed)?(r(a.view),U(null)):C.fetchAndSetProfile(n.args.username)}}),e("div",{className:"videos",ref:N,onMouseDown:S,children:c==null?void 0:c.map((b,G)=>e(Ae,{data:b,active:O===c.indexOf(b)&&Z},G))})]})}const B=i.createContext(null);function Gt(){const t=ve(re.Settings),[h,P]=i.useState(null),[C,v]=i.useState("feed"),[u,m]=i.useState(null),[f,d]=i.useState(null),[r,n]=i.useState(null),[l,a]=i.useState(null),[U,y]=i.useState(null),[_,T]=i.useState(null),[w,E]=i.useState(!1),[V,R]=i.useState(null),[A,c]=i.useState(!0),[k,O]=i.useState(!0);i.useEffect(()=>{ut()&&(P({name:"Breze",username:"breze",follower_count:1553223,following_count:142,like_count:6126533,avatar:"https://source.unsplash.com/random",bio:"This is a test bio",twitter:"breze",instagram:"breze",verified:!0}),E(!0),c(!1)),L("isAdmin").then(x=>{if(ie.APPS.TIKTOK.account.value){P({...ie.APPS.TIKTOK.account.value,isAdmin:x}),E(!0),c(!1);return}else if(ie.APPS.TIKTOK.account.value===!1)return c(!1);L("TikTok",{action:"isLoggedIn"}).then(M=>{M?(ie.APPS.TIKTOK.account.set(M),P({...M,isAdmin:x}),E(!0),c(!1)):(ie.APPS.TIKTOK.account.set(!1),c(!1))})})},[]),i.useEffect(()=>{C==="feed"&&u||C==="profile"&&(u==null?void 0:u.username)!==h.username?O(!1):O(!0)},[u]);const p={profile:e(Ut,{}),video:e(Ae,{}),discover:e(ht,{}),inbox:e(pt,{}),messages:e(gt,{}),dm:e(Nt,{}),upload:e(yt,{}),feed:e(_e,{})},N=x=>{if(!x)return g("warning","Couldn't fetch profile (no username provided)");g("info",`Fetching profile ${x}`),L("TikTok",{action:"getProfile",username:x}).then(M=>{if(!M)return g("warning","Couldn't fetch profile");m(M),v("profile")})},F=(x,M)=>{L("TikTok",{action:"getVideo",id:x}).then(j=>{if(!j)return g("warning","Couldn't fetch video");if(j.error)return g("warning",j.error);y({video:j.video,args:M}),v("feed")})};return e(B.Provider,{value:{User:[h,P],View:[C,v],Profile:[u,m],LoggedIn:[w,E],FeedData:[U,y],UserPanel:[r,n],ShareComponent:[l,a],GoBack:[_,T],Video:[V,R],Dm:[f,d],Func:{fetchAndSetProfile:N,fetchAndSetVideo:F}},children:A||t!=null&&t.airplaneMode?e("div",{className:"loading",children:e(xe,{size:40,lineWeight:5,speed:2,color:(t==null?void 0:t.display.theme)==="dark"?"#ffffff":"#000000"})}):e("div",{className:"tiktok-container","data-infeed":C==="feed",children:w===!0?s(z,{children:[s("div",{className:"tiktok-wrapper","data-profile":!k,children:[e(_e,{}),C!=="feed"&&e("div",{className:"tiktok-content",children:p==null?void 0:p[C]}),e(he,{children:r&&e(kt,{})})]}),e(he,{children:l&&e(Ot,{})}),k&&e(wt,{})]}):e(It,{})})})}const q=t=>t??"./assets/img/icons/tiktok/no-pfp.jpg",Ce=t=>{if(!t)return;const h=new Date(t),C=new Date().getTime()-h.getTime(),v=Math.floor(C/(1e3*3600*24)),u=Math.floor(C/(1e3*3600)),m=Math.floor(C/(1e3*60)),f=Math.floor(C/1e3);return v>0?`${h.getMonth()+1}-${h.getDate()}`:u>0?`${u}h`:m>0?`${m}m`:f>0?`${f}s`:o("NOW")};function Y(t){if(t<1e4)return t;if(t>=1e4&&t<1e6)return`${(t/1e3).toFixed(1)}K`;if(t>=1e6&&t<1e9)return`${(t/1e6).toFixed(1)}M`}export{B as TikTokContext,Gt as default,Ce as formatDate,Y as formatNumber,q as getAvatar};
