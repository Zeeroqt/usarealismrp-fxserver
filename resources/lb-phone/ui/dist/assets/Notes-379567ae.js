import{r as E,j as a,a as l}from"./jsx-runtime-7cf68bf7.js";import{j as N,f as S,L as o,a7 as C,al as v,aA as g,x as L,aE as w,aT as D,C as P,aU as I,d as u}from"./PhoneProvider-fb5cb781.js";import"./number-28525126.js";function k(){const[c,f]=E.useState(""),[d,m]=E.useState([]),[n,i]=E.useState(null);E.useEffect(()=>{if(N.APPS.NOTES.notes.value)return m(N.APPS.NOTES.notes.value);S("Notes",{action:"fetch"}).then(e=>{m(e),N.APPS.NOTES.notes.set(e)})},[]);const p=e=>{let s=Math.floor(Date.now()),t={title:o("APPS.NOTES.NEW_NOTE"),content:"",timestamp:s,id:null};S("Notes",{action:"create",data:t}).then(r=>{t.id=r,i(t),m([...d,t]),N.APPS.NOTES.notes.set({...d,tempData:t})})},O=e=>{let s=Math.floor(Date.now()),t=[...d],r=t.findIndex(T=>T.id===e.id),h=t[r];if(h.title===e.title&&h.content===e.content){u("info","Note is the same, not saving"),i(null);return}t[r]={...e,timestamp:s},S("Notes",{action:"save",data:t[r]}).then(T=>{if(!T)return u("warning","Failed to save note, server returned false");u("info","Saved note"),i(null),m(t),N.APPS.NOTES.notes.set(t)})},A=e=>{S("Notes",{action:"remove",id:e}).then(s=>{if(!s)return u("warning","Failed to remove note, server returned false");let t=d.filter(r=>r.id!==e);i(null),m(t),N.APPS.NOTES.notes.set(t),u("info","Removed note")})};return a("div",{className:"notes-container slide-right",children:n?l("div",{className:"notes-wrapper slide-left",children:[l("div",{className:"top",children:[l("div",{className:"back",onClick:()=>O(n),children:[a("i",{className:"fal fa-chevron-left"}),o("APPS.NOTES.TITLE")]}),a(L,{className:"title",defaultValue:n.title,onChange:e=>{i({...n,title:e.target.value})}}),a("div",{})]}),a(w,{onChange:e=>{i({...n,content:e.target.value})},defaultValue:n.content}),l("div",{className:"notes-bottom",children:[a(D,{onClick:()=>P.PopUp.set({title:o("APPS.NOTES.DELETE_TITLE").format({title:n.title}),description:o("APPS.NOTES.DELETE_TEXT").format({title:n.title}),buttons:[{title:o("APPS.NOTES.BUTTON_CANCEL")},{title:o("APPS.NOTES.BUTTON_DELETE"),color:"red",cb:()=>{A(n.id)}}]})}),a("div",{className:"amount",children:o("APPS.NOTES.LAST_EDITED").format({date:v(n.timestamp)})}),a(I,{onClick:()=>P.Share.set({type:"note",data:n})})]})]}):l("div",{className:"notes-wrapper slide-right",children:[a("div",{className:"title",children:o("APPS.NOTES.TITLE")}),a(C,{placeholder:o("APPS.NOTES.SEARCH_PLACEHOLDER"),onChange:e=>f(e.target.value)}),a("div",{className:"notes-body",children:a("div",{className:"notes-list",children:d.filter(e=>{var s,t;return((s=e.title)==null?void 0:s.toLowerCase().includes(c==null?void 0:c.toLowerCase()))||((t=e.content)==null?void 0:t.toLowerCase().includes(c==null?void 0:c.toLowerCase()))}).sort((e,s)=>s.timestamp-e.timestamp).map((e,s)=>l("div",{className:"note-item",onClick:()=>{i(e)},children:[a("div",{className:"note-title",children:e.title}),l("div",{className:"note-details",children:[a("div",{className:"date",children:v(e.timestamp)}),a("div",{className:"content",children:e.content.length>30?e.content.slice(0,30)+"...":e.content})]})]},s))})}),l("div",{className:"notes-bottom",children:[a("div",{}),a("div",{className:"amount",children:o("APPS.NOTES.FOOTER").format({amount:d.length})}),a(g,{onClick:p})]})]})})}export{k as default};
